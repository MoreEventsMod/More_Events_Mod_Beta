mem_xaal_engine_effect = {
	random_list = {
		15 = {
			mem_xaal_random_swap = yes
			add_deposit = d_mem_xaal_probabilistic_colony
			from = { country_event = { id = mem_xaal.1 } }
		}
		3 = {
			change_pc = pc_relic
			clear_deposits = yes
			relic_world_deposits = yes
			from = {
				change_variable = {
					which = mem_xaal_relic_timer
					value = 10
				}
				country_event = { id = mem_xaal.2 }
			}
			modifier = {
				factor = 0
				from = {
					check_variable = {
						which = mem_xaal_relic_timer
						value > 0					
					}
				}
			}
		}
		3 = {
			change_pc = pc_shielded
			clear_deposits = yes
			add_deposit = d_society_10
			from = {
				country_event = { id = mem_xaal.3 }
			}
		}
		3 = {
			change_pc = pc_shattered
			clear_deposits = yes
			add_deposit = d_engineering_10
			from = {
				country_event = { id = mem_xaal.4 }
			}
		}
		3 = {
			change_pc = pc_mem_phased
			clear_deposits = yes
			add_deposit = d_physics_10
			from = {
				country_event = { id = mem_xaal.5 }
			}
		}
		2 = {
			mem_xaal_create_random_presap = yes
			while = {
				count = 3
				create_pop = {
					species = last_created_species
				}
			}
			from = {
				change_variable = {
					which = mem_xaal_presap_timer
					value = 10
				}
				country_event = {
					id = mem_xaal.6
				}
			}
			modifier = {
				factor = 0
				from = {
					check_variable = {
						which = mem_xaal_presap_timer
						value > 0					
					}
				}
			}
		}
		7 = {
			generate_primitives_on_planet = yes
			from = {
				change_variable = {
					which = mem_xaal_primitive_timer
					value = 10
				}
				country_event = { id = mem_xaal.7 }
				every_relation = {
					establish_communications_no_message = last_created_country
				}
			}
		}
		5 = {
			change_pc = pc_nuked
			reroll_planet = yes
			from = {
				country_event = { id = mem_xaal.8 }
			}
		}
		5 = {
			from = {
				random_owned_pop = {
					limit = {
						has_citizenship_rights = yes
						prevprev = {
							habitability = { who = prev value > 0.7 }
						}
					}
					save_event_target_as = colony_species
				}
				change_variable = {
					which = mem_xaal_colony_timer
					value = 10
				}
			}
			mem_xaal_generate_phased_in_colony = yes
			from = {
				country_event = { id = mem_xaal.9 }
			}
			modifier = {
				factor = 0
				from = {
					OR = {
						check_variable = {
							which = mem_xaal_colony_timer
							value > 0
						}
						NOT = {
							any_owned_pop = {
								has_citizenship_rights = yes
								prevprev = {
									habitability = { who = prev value > 0.7 }
								}
							}
						}
					}
				}
			}
			modifier = {
				factor = 0
				is_cold = no
				is_wet = no
				is_dry = no
				NOT = { is_planet_class = pc_gaia }
				NOT = { is_planet_class = pc_nuked }
			}
		}
		8 = {
			from = {
				country_event = { id = mem_xaal.10 }
			}
		}
		8 = {
			from = {
				country_event = { id = mem_xaal.11 }
			}
		}
	}
	from = { mem_xaal_decrease_timer = yes }
}

mem_xaal_random_swap = {
	random_list = {
		2 = {
			change_pc = pc_continental
			modifier = {
				factor = 0
				is_wet = yes
			}
		}
		2 = {
			change_pc = pc_ocean
			modifier = {
				factor = 0
				is_wet = yes
			}
		}
		2 = {
			change_pc = pc_tropical
			modifier = {
				factor = 0
				is_wet = yes
			}
		}
		2 = {
			change_pc = pc_arid
			modifier = {
				factor = 0
				is_dry = yes
			}
		}
		2 = {
			change_pc = pc_savannah
			modifier = {
				factor = 0
				is_dry = yes
			}
		}
		2 = {
			change_pc = pc_desert
			modifier = {
				factor = 0
				is_dry = yes
			}
		}
		2 = {
			change_pc = pc_arctic
			modifier = {
				factor = 0
				is_cold = yes
			}
		}
		2 = {
			change_pc = pc_tundra
			modifier = {
				factor = 0
				is_cold = yes
			}
		}
		2 = {
			change_pc = pc_alpine
			modifier = {
				factor = 0
				is_cold = yes
			}
		}
		2 = {
			change_pc = pc_gaia
			from = {
				change_variable = {
					which = mem_xaal_gaia_timer
					value = 2
				}
			}
			modifier = {
				factor = 0
				from = {
					check_variable = {
						which = mem_xaal_gaia_timer
						value > 0						
					}
				}
			}
			modifier = {
				factor = 0
				is_planet_class = pc_gaia
			}
		}
	}
	reroll_planet = yes
}

mem_xaal_create_random_presap = {
	random_list = {
		1 = {
			create_species = {
				name = random
				class = "PRE_REP"
				portrait = random
				traits = {
					trait = random_presapient_trait
				}
				homeworld = this
				sapient = no
			}
		}
		1 = {
			create_species = {
				name = random
				class = "PRE_MAM"
				portrait = random
				traits = {
					trait = random_presapient_trait
				}
				homeworld = this
				sapient = no
			}
		}
		1 = {
			create_species = {
				name = random
				class = "PRE_AVI"
				portrait = random
				traits = {
					trait = random_presapient_trait
				}
				homeworld = this
				sapient = no
			}
		}
		1 = {
			create_species = {
				name = random
				class = "PRE_MOL"
				portrait = random
				traits = {
					trait = random_presapient_trait
				}
				homeworld = this
				sapient = no
			}
		}
		1 = {
			create_species = {
				name = random
				class = "PRE_ART"
				portrait = random
				traits = {
					trait = random_presapient_trait
				}
				homeworld = this
				sapient = no
			}
		}
		1 = {
			create_species = {
				name = random
				class = "PRE_FUN"
				portrait = random
				traits = {
					trait = random_presapient_trait
				}
				homeworld = this
				sapient = no
			}
		}
	}
}

mem_xaal_generate_phased_in_colony = {
	set_owner = from
	add_deposit = d_mem_xaal_probabilistic_colony
	IF = {
		limit = {
			from = { is_regular_empire = yes }
		}
		add_building = building_capital
		while = {
			count = 1
			add_district = district_city
		}
	}
	ELSE_IF = {
		limit = {
			from = { is_machine_empire = yes }
		}
		add_building = building_machine_capital
		while = {
			count = 1
			add_district = district_nexus
		}
	}
	ELSE_IF = {
		limit = {
			from = { is_hive_empire = yes }
		}
		add_building = building_hive_capital
		while = {
			count = 1
			add_district = district_hive
		}
	}
	while = {
		count = 2
		add_district = district_mining
		add_district = district_generator
	}
	IF = {
		limit = {
			from = { is_machine_empire = yes }
		}
		add_district = district_mining
		add_district = district_generator
	}
	ELSE = {
		add_district = district_farming
		add_district = district_farming
	}
	add_building = building_research_lab_1
	add_building = building_foundry_1
	add_building = building_fortress
	while = {
		count = 12
		create_pop = { species = event_target:colony_species }
	}
}

mem_xaal_decrease_timer = {
	IF = {
		limit = {
			check_variable = {
				which = mem_xaal_colony_timer
				value > 0				
			}
		}
		change_variable = {
			which = mem_xaal_colony_timer
			value = -1			
		}
	}
	IF = {
		limit = {
			check_variable = {
				which = mem_xaal_gaia_timer
				value > 0				
			}
		}
		change_variable = {
			which = mem_xaal_gaia_timer
			value = -1			
		}
	}
	IF = {
		limit = {
			check_variable = {
				which = mem_xaal_relic_timer
				value > 0				
			}
		}
		change_variable = {
			which = mem_xaal_relic_timer
			value = -1			
		}
	}
	IF = {
		limit = {
			check_variable = {
				which = mem_xaal_presap_timer
				value > 0				
			}
		}
		change_variable = {
			which = mem_xaal_presap_timer
			value = -1			
		}
	}
	IF = {
		limit = {
			check_variable = {
				which = mem_xaal_primitive_timer
				value > 0				
			}
		}
		change_variable = {
			which = mem_xaal_primitive_timer
			value = -1			
		}
	}
}