#Gives intruding empire some tech
mem_broken_clock_give_tech = {
    #Basic means of pruduction
    give_technology = {
        tech = tech_powered_exoskeletons
        message = no
    }
    give_technology = {
        tech = tech_mining_network_2
        message = no
    }
    give_technology = {
        tech = tech_mining_network_3
        message = no
    }
    give_technology = {
        tech = tech_mining_network_4
        message = no
    }
    IF = {
        limit = {
            NOT = {
                has_authority = auth_machine_intelligence
            }
        }
        give_technology = {
            tech = tech_hydroponics
            message = no
        }
        give_technology = {
            tech = tech_gene_crops
            message = no
        }
        give_technology = {
            tech = tech_nano_vitality_crops
            message = no
        }
    }
    give_technology = {
        tech = tech_power_plant_2
        message = no
    }
    give_technology = {
        tech = tech_power_plant_3
        message = no
    }
    give_technology = {
        tech = tech_power_plant_4
        message = no
    }
    give_technology = {
        tech = tech_power_hub_1
        message = no
    }

    give_technology = {
        tech = tech_heritage_site
        message = no
    }
    give_technology = {
        tech = tech_hypercomms_forum
        message = no
    }
    
    give_technology = {
        tech = tech_planetary_unification
        message = no
    }
    give_technology = {
        tech = tech_colonial_centralization
        message = no
    }
    give_technology = {
        tech = tech_galactic_administration
        message = no
    }

    #Ship sizes and ship hull upgrades (Level 1 for all but battleships)
    give_technology = {
        tech = tech_destroyers
        message = no
    }
    give_technology = {
        tech = tech_cruisers
        message = no
    }
    give_technology = {
        tech = tech_battleships
        message = no
    }
    give_technology = {
        tech = tech_corvette_hull_1
        message = no
    }
    give_technology = {
        tech = tech_destroyer_hull_1
        message = no
    }
    give_technology = {
        tech = tech_cruiser_hull_1
        message = no
    }

    give_technology = {
        tech = tech_starbase_3
        message = no
    }
    give_technology = {
        tech = tech_starbase_4
        message = no
    }
    give_technology = {
        tech = tech_synchronized_defences
        message = no
    }

    #Tier 2 labs
    give_technology = {
        tech = tech_biolab_1
        message = no
    }
    give_technology = {
        tech = tech_engineering_lab_1
        message = no
    }
    give_technology = {
        tech = tech_physics_lab_1
        message = no
    }
    give_technology = {
        tech = tech_biolab_2
        message = no
    }
    give_technology = {
        tech = tech_engineering_lab_2
        message = no
    }
    give_technology = {
        tech = tech_physics_lab_2
        message = no
    }

    #All basic weapons to tier 3
    give_technology = {
        tech = tech_lasers_2
        message = no
    }
    give_technology = {
        tech = tech_lasers_3
        message = no
    }
    give_technology = {
        tech = tech_mass_drivers_2
        message = no
    }
    give_technology = {
        tech = tech_mass_drivers_3
        message = no
    }
    give_technology = {
        tech = tech_missiles_2
        message = no
    }
    give_technology = {
        tech = tech_missiles_3
        message = no
    }

    #Tier1 advanced weapons
    give_technology = {
        tech = tech_energy_lance_1
        message = no
    }
    give_technology = {
        tech = tech_mass_accelerator_1
        message = no
    }
    give_technology = {
        tech = tech_kinetic_artillery_1
        message = no
    }
    give_technology = {
        tech = tech_energy_torpedoes_1
        message = no
    }

    #Tier 2 supplementary tech
    give_technology = {
        tech = tech_plasma_1
        message = no
    }
    give_technology = {
        tech = tech_plasma_2
        message = no
    }
    give_technology = {
        tech = tech_autocannons_1
        message = no
    }
    give_technology = {
        tech = tech_autocannons_2
        message = no
    }
    give_technology = {
        tech = tech_torpedoes_1
        message = no
    }
    give_technology = {
        tech = tech_torpedoes_2
        message = no
    }

    #Tier 2 strike crafts and PD, Tier 1 flack
    give_technology = {
        tech = tech_pd_tracking_1
        message = no
    }
    give_technology = {
        tech = tech_pd_tracking_2
        message = no
    }
    give_technology = {
        tech = tech_flak_batteries_1
        message = no
    }
    give_technology = {
        tech = tech_strike_craft_1
        message = no
    }
    give_technology = {
        tech = tech_strike_craft_2
        message = no
    }

    #Tier 3 armour and shields
    give_technology = {
        tech = tech_ship_armor_2
        message = no
    }
    give_technology = {
        tech = tech_ship_armor_3
        message = no
    }
    give_technology = {
        tech = tech_shields_2
        message = no
    }
    give_technology = {
        tech = tech_shields_3
        message = no
    }

    #Tier 3 drives, egines, power and radars
    give_technology = {
        tech = tech_hyper_drive_2
        message = no
    }
    give_technology = {
        tech = tech_hyper_drive_3
        message = no
    }
    give_technology = {
        tech = tech_thrusters_2
        message = no
    }
    give_technology = {
        tech = tech_thrusters_3
        message = no
    }
    give_technology = {
        tech = tech_sensors_2
        message = no
    }
    give_technology = {
        tech = tech_sensors_3
        message = no
    }
    give_technology = {
        tech = tech_fusion_power
        message = no
    }
    give_technology = {
        tech = tech_cold_fusion_power
        message = no
    }

    #Tier 2 combat computers
    give_technology = {
        tech = tech_combat_computers_1
        message = no
    }
    give_technology = {
        tech = tech_combat_computers_2
        message = no
    }
    
    #Tier 2 command limit and fleet limit techs
    give_technology = {
        tech = tech_doctrine_fleet_size_1
        message = no
    }
    give_technology = {
        tech = tech_doctrine_fleet_size_2
        message = no
    }
    give_technology = {
        tech = tech_doctrine_navy_size_1
        message = no
    }
    give_technology = {
        tech = tech_doctrine_navy_size_2
        message = no
    }


}

#Fills their worlds with buildings (Not counting capitals)
mem_broken_clock_set_buildings = {
    while = {
        limit = {
            any_tile = {
                has_building = no
            }
        }
        random_tile = {
            limit = {
                has_building = no
            }
            set_building = building_mining_network_4
            set_deposit = d_mineral_deposit
        }
        random_tile = {
            limit = {
                has_building = no
            }
            set_building = building_power_plant_4
            set_deposit = d_energy_deposit
        }
        IF = {
            limit = {
                owner { NOT = { has_authority = auth_machine_intelligence } }
            }
            random_tile = {
                limit = {
                    has_building = no
                }
                set_building = building_hydroponics_farm_4
                set_deposit = d_farmland_deposit
            }
        }
        random_tile = {
            limit = {
                has_building = no
                NOT = {
                    any_neighboring_tile = {
                        OR = {
                            has_building = "building_capital_1"
                            has_building = "building_capital_2"
                            has_building = "building_capital_3"
                        }
                    }
                }
            }
            random_list = {
                1 = { set_building = building_engineering_facility_2 }
                1 = { set_building = building_physics_lab_2 }
                1 = { set_building = building_biolab_2 }
            }
            random_list = {
                1 = { set_deposit = d_society_deposit }
                1 = { set_deposit = d_physics_deposit }
                1 = { set_deposit = d_engineering_deposit }
            }
        }
    }
}

#Creating fully furnished habitat
mem_broken_clock_create_habitat = {
    solar_system = {
        spawn_planet = {
            class = "pc_habitat"
            location = prev
            orbit_location = yes
            orbit_angle_offset = 45
            orbit_distance_offset = 9.899
            size = 12
            has_ring = no
        
            init_effect = {
                set_name = "[PrevPrev.GetName] Habitat"
                set_owner = event_target:unwelcome_guests
                set_planet_entity = {
                    entity = "orbital_habitat_entity"
                    graphical_culture = event_target:unwelcome_guests
                }
                while = {
                    limit = {
                        any_tile = { has_blocker = yes }
                    }
                    random_tile = {
                        limit = { has_blocker = yes }
                        remove_blocker = yes
                    }
                }
                every_tile = {
                    create_pop = {
                        species = event_target:unwelcome_guests
                    }
                }
                random_tile = {
                    limit = { has_building = no }
                    set_building = building_hab_capital
                }
                random_tile = {
                    limit = { has_building = no }
                    set_building = building_hab_cultural_center
                }
                random_tile = {
                    limit = { has_building = no }
                    set_building = building_hab_stronghold
                }
                while = {
                    limit = { any_tile = { has_building = no } }
                    random_tile = {
                        limit = { has_building = no }
                        set_building = building_hab_solar_power_processor
                    }
                    random_list = {
                        1 = {
                            random_tile = {
                                limit = { has_building = no }
                                set_building = building_hab_astro_mining_facility
                            }
                        }
                        1 = {
                            random_tile = {
                                limit = { has_building = no }
                                set_building = building_hab_agri_bay
                            }
                            modifier = {
                                factor = 0
                                event_target:unwelcome_guests = { has_authority = auth_machine_intelligence }
                            }
                        }
                    }
                }
            }
        }
    }
}