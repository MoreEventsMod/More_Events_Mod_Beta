# (Primitive) country scope
shift_primitive_pop_ethic = {
	capital_scope = {
		add_modifier = {
			modifier = espionage_pre_ftl_indoctrination_$ETHIC$
			years = 5
		}
	}
	while = {
		count = value:pre_ftl_pops_shifting_ethic|BONUS|$BONUS$|
		random_owned_pop = {
			limit = {
				is_$ETHIC$ = no
			}
			pop_change_ethic = ethic_$ETHIC$
		}
	}
}

#planet scope creates primitive civ with last created species and needs origin flag on planet
mem_generate_chosen_early_pre_ftls_on_planet = {
	#planet flag for origin has to be set manually before this effect
	#Don't create species. Last created species is already correct
	mem_create_early_pre_ftl_empire = yes
	setup_pre_ftl_planet = yes
	pre_ftl_clean_up_effect = yes
}

#planet scope creates primitive civ with last created species and needs origin flag on planet
mem_generate_chosen_mid_pre_ftls_on_planet = {
	#planet flag for origin has to be set manually before this effect
	#Don't create species. Last created species is already correct
	mem_create_mid_pre_ftl_empire = yes
	setup_pre_ftl_planet = yes
	pre_ftl_clean_up_effect = yes
}

#planet scope creates primitive civ with last created species and needs origin flag on planet
mem_generate_chosen_late_pre_ftls_on_planet = {
	#planet flag for origin has to be set manually before this effect
	#Don't create species. Last created species is already correct
	create_late_pre_ftl_empire = yes
	setup_pre_ftl_planet = yes
	pre_ftl_clean_up_effect = yes
}

#planet scope creates primitive civ with last created species
mem_create_early_pre_ftl_empire = {
	create_country = {
		name = random
		authority = random
		civics = {
			civic = civic_landed_nobility
			civic = civic_flat_world_theory
		}
		species = last_created_species
		ethos = random
		flag = {
			icon = {
				category = "pre_ftl"
				file = "preftl_stone_age.dds"
			}
			background= {
				category = "backgrounds"
				file = "new_dawn.dds"
			}
			colors={
				"turquoise"
				"green"
				"null"
				"null"
			}
		}
		origin = "origin_default"
		type = primitive
	}
	last_created_country = {
		set_graphical_culture = preindustrial_01
		random_list = {
			20 = {
				set_country_flag = bronze_age
				set_pre_ftl_age = bronze_age
				change_government = {
					authority = random
					civics = {
						civic = civic_secret_of_fire
						civic = civic_the_wheel
					}
				}
				change_country_flag = {
					icon = {
						category = "pre_ftl"
						file = "preftl_bronze_age.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"green"
						"dark_green"
						"null"
						"null"
					}
				}
			}
			20 = {
				set_country_flag = iron_age
				set_pre_ftl_age = iron_age
				change_country_flag = {
					icon = {
						category = "pre_ftl"
						file = "preftl_iron_age.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"purple"
						"dark_purple"
						"null"
						"null"
					}
				}
			}
			20 = {
				set_country_flag = late_medieval_age
				set_pre_ftl_age = late_medieval_age
				change_country_flag = {
					icon = {
						category = "pre_ftl"
						file = "preftl_medieval_age.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"light_blue"
						"blue"
						"null"
						"null"
					}
				}
			}
		}
	}
	set_pre_ftl_origin = yes
}

#planet scope creates primitive civ with last created species
mem_create_mid_pre_ftl_empire = {
	create_country = {
		name = random
		authority = random
		civics = {
			civic = civic_landed_nobility
			civic = civic_flat_world_theory
		}
		species = last_created_species
		ethos = random
		flag = {
			icon = {
				category = "pre_ftl"
				file = "preftl_stone_age.dds"
			}
			background= {
				category = "backgrounds"
				file = "new_dawn.dds"
			}
			colors={
				"turquoise"
				"green"
				"null"
				"null"
			}
		}
		origin = "origin_default"
		type = primitive
	}
	last_created_country = {		
		random_list = {
			20 = {
				set_graphical_culture = preindustrial_01
				set_country_flag = late_medieval_age
				set_pre_ftl_age = late_medieval_age
				change_country_flag = {
					icon = {
						category = "pre_ftl"
						file = "preftl_medieval_age.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"light_blue"
						"blue"
						"null"
						"null"
					}
				}
			}
			20 = {
				set_graphical_culture = preindustrial_01
				set_country_flag = renaissance_age
				set_pre_ftl_age = renaissance_age
				change_country_flag = {
					icon = {
						category = "pre_ftl"
						file = "preftl_renaissance_age.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"pink"
						"burgundy"
						"null"
						"null"
					}
				}
			}
			20 = {
				set_graphical_culture = preindustrial_01
				set_country_flag = steam_age
				set_pre_ftl_age = steam_age
				change_country_flag = {
					icon = {
						category = "pre_ftl"
						file = "preftl_steam_age.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"orange"
						"red"
						"null"
						"null"
					}
				}
			}
			20 = {
				set_graphical_culture = industrial_01
				set_country_flag = industrial_age
				set_pre_ftl_age = industrial_age
				change_country_flag = {
					icon = {
						category = "pre_ftl"
						file = "preftl_industrial_age.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"beige"
						"yellow"
						"null"
						"null"
					}
				}
			}
			20 = {
				set_graphical_culture = industrial_01
				set_country_flag = machine_age
				set_pre_ftl_age = machine_age
				change_country_flag = {
					icon = {
						category = "pre_ftl"
						file = "preftl_machine_age.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"yellow"
						"orange"
						"null"
						"null"
					}
				}
			}
		}
	}
	set_pre_ftl_origin = yes
}

#planet scope creates primitive civ with last created species
mem_create_late_pre_ftl_empire = {
	create_country = {
		name = random
		authority = random
		civics = {
			civic = civic_increasing_urbanization
			civic = civic_atmospheric_pollution
		}
		species = last_created_species
		ethos = random
		flag = {
			icon = {
				category = "pre_ftl"
				file = "preftl_industrial_age.dds"
			}
			background= {
				category = "backgrounds"
				file = "new_dawn.dds"
			}
			colors={
				"turquoise"
				"green"
				"null"
				"null"
			}
		}
		origin = "origin_default"
		type = primitive
	}
	last_created_country = {
		set_graphical_culture = industrial_01
		random_list = {
			25 = {
				set_country_flag = industrial_age
				set_pre_ftl_age = industrial_age
				change_country_flag = {
					icon = {
						category = "pre_ftl"
						file = "preftl_industrial_age.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"beige"
						"yellow"
						"null"
						"null"
					}
				}
			}
			25 = {
				set_country_flag = machine_age
				set_pre_ftl_age = machine_age
				change_country_flag = {
					icon = {
						category = "pre_ftl"
						file = "preftl_machine_age.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"yellow"
						"orange"
						"null"
						"null"
					}
				}
			}
			25 = {
				set_country_flag = atomic_age
				set_pre_ftl_age = atomic_age
				change_country_flag = {
					icon = {
						category = "pre_ftl"
						file = "preftl_atomic_age.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"beige"
						"brown"
						"null"
						"null"
					}
				}
			}
		}
	}
	set_pre_ftl_origin = yes
}

mem_create_ancient_protector_country = {
	IF = {
		limit = {
			NOT = {
				exists = event_target:mem_ancient_protector_country
			}
		}
		mem_create_drone_country = yes
	}
}

#creates Ancient Protectors of [system]
mem_create_drone_country = {
	create_country = {
		name = {
			key = NAME_Ancient_Protectors
			variable_string = "\\[solar_system.GetName\\]"
		}
		name_list = "ORILA"
		species = random
		type = mem_ancient_protectors
		flag = {
			icon = {
				category = "blocky"
				file = "flag_blocky_16.dds"
			}
			background = {
				category = "backgrounds"
				file = "mem_orila_stripes_2.dds"
			}
			colors = {
				"white"
				"dark_grey"
				"null"
				"null"
			}
		}
	}
	last_created_country = {
		set_graphical_culture = mem_ancient_01
		set_country_flag = mem_ancient_protector_country
	#	save_global_event_target_as = mem_ancient_protector_country
		create_ship_design = { design = "NAME_mem_Asgard" }
		add_ship_design = last_created_design
	}
}

mem_create_orila_ai_station = {
	create_fleet = {
		settings = {
			spawn_debris = no
		}
		effect = {
			set_owner = last_created_country
			create_ship = {
				name = random
				design = "NAME_mem_Utgard"
				graphical_culture = mem_ancient_01
			}
			set_location = {
				target = prev
				distance = 5
				angle = random
			}
			set_fleet_flag = mem_orila_ancient_protector_station				
		}
	}
}

mem_create_destroyed_orila_system_objects = {
	random_system_planet = {
		limit = {
			is_primary_star = yes
		}
		random_list = {
			40 = {
				create_ambient_object = {
					type = mem_orila_spaceport_wreckage_object
					location = this
				}
				last_created_ambient_object = {
					set_location = {
						target = prev
						distance = 20
						angle = 120
					}
					create_ambient_object = {
						type = small_debris_object
						entity_offset_height = { min = 5 max = -5 }
						location = this
					}
				}
			}
			60 = {
				create_ambient_object = {
					type = small_debris_object
					entity_offset_height = { min = 5 max = -5 }
					location = this
				}
				last_created_ambient_object = {
					set_location = {
						target = prev
						distance = 20
						angle = 120
					}							
				}
			}
		}
	}
	every_system_planet = {
		limit = {
			has_planet_flag = mem_orila_primitive_world
		}
		random_list = {
			40 = {
				create_ambient_object = {
					type = mem_orila_small_station_wreckage_object
					location = this
				}
				last_created_ambient_object = {
					set_location = {
						target = prev
						distance = 5
						angle = random
					}
					create_ambient_object = {
						type = small_debris_object
						entity_offset_height = { min = 5 max = -5 }
						location = this
					}
				}
			}
			60 = {
				create_ambient_object = {
					type = small_debris_object
					entity_offset_height = { min = 5 max = -5 }
					location = this
				}
				last_created_ambient_object = {
					set_location = {
						target = prev
						distance = 5
						angle = random
					}							
				}
			}
		}
	}
}

mem_setup_orila_primitive_system = {
	if = {
		limit = {
			has_star_flag = mem_orila_primitive_system_destroyed
		}
		mem_create_destroyed_orila_system_objects = yes
	}
	else = {
	#	mem_create_ancient_protector_country = yes
		mem_create_drone_country = yes
		create_starbase = {
			size = mem_ancient_spaceport
			owner = last_created_country
		}
		every_system_planet = {
			limit = {
				has_planet_flag = mem_orila_primitive_world
			}
			mem_create_orila_ai_station = yes
		}
	}		
}

#parts of this are copied from the spawn_old_foes_effect 
mem_create_post_apocalyptic_primitives = {
	if = {
		limit = {
			host_has_dlc = "Plantoids Species Pack"
		}
		create_species = {
			name = NAME_Jibru
			plural = NAME_Jibru
			class = FUN
			portrait = fun17
			namelist = FUN2
			traits = {
				trait = trait_survivor
				trait = trait_plantoid_budding
				trait = trait_plantoid_radiotrophic
				trait = trait_fleeting
				trait = trait_deviants
			}
			homeworld = this
		}
	}
	else = {
		create_species = {
			name = random
			class = random_non_machine
			portrait = random
			traits = {
				trait = trait_survivor
				trait = trait_very_strong
				trait = trait_rapid_breeders
				trait = trait_resilient
				trait = trait_repugnant
				trait = trait_unruly
			}
			homeworld = this
		}
	}	
	change_pc = pc_nuked
	clear_blockers = yes
	add_blocker = {
		type = d_bomb_crater
	}
	add_blocker = {
		type = d_bomb_crater
	}
	add_blocker = {
		type = d_city_ruins
	}
	add_blocker = {
		type = d_radioactive_wasteland
	}
	add_blocker = {
		type = d_radioactive_wasteland
	}
	add_blocker = {
		type = d_dangerous_wildlife_blocker
	}
	create_country = {
		name = random
		authority = random
		civics = {
			civic = civic_secret_of_fire
			civic = civic_the_wheel
		}
		species = last_created_species
		ethos = random
		origin = "origin_post_apocalyptic"
		flag = {
			icon = {
				category = "pre_ftl"
				file = "preftl_bronze_age.dds"
			}
			background= {
				category = "backgrounds"
				file = "new_dawn.dds"
			}
			colors={
				"turquoise"
				"green"
				"null"
				"null"
			}
		}
		type = primitive
	}
	last_created_country = {
		set_country_flag = bronze_age
		set_pre_ftl_age = bronze_age
		set_graphical_culture = preindustrial_01
	}
	set_owner = last_created_country
	set_capital = yes
	while = {
		count = @bronze_age_pops
		create_pop = {
			species = last_created_species
		}
	}
	add_building = building_primitive_dwellings
	add_building = building_stone_palace
}