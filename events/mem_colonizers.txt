# Confederacy of the Endless Sea
# By ViolentBeetle

namespace = mem_colonizers

# On first viting the system
ship_event = {
	id = mem_colonizers.1
	title = mem_colonizers.1.name
	desc = mem_colonizers.1.desc

	is_triggered_only = yes

	location = FROM
	picture = GFX_evt_federation_fleet
	show_sound = event_alien_signal

	trigger = {
		owner = {
			is_country_type = default
			NOT = { has_country_flag = mem_colonizers_established_contact }
		}
		FROM = {
			has_star_flag = mem_colonizers_contact_trigger
			any_neighbor_system = {
				exists = space_owner
				space_owner = {
					is_country_type = mem_colonizers_dormant_country
				}
			}
		}
	}

	immediate = {
		owner = {
			set_country_flag = mem_colonizers_established_contact
		}
	}

	option = {
		name = ONSCREEN
		owner = {
			hidden_effect = {
				country_event = {
					id = mem_colonizers.2
				}
			}
			add_resource = {
				influence = 30
			}
		}
	}
}

# Diplomatic event
country_event = {
	id = mem_colonizers.2
	title = MEM_COLONIZERS_HEADER
	desc = mem_colonizers.2.desc

	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		room = mem_colonizers_room
	}

	immediate = {
		random_country = {
			limit = {
				is_country_type = mem_colonizers_dormant_country
			}
			establish_communications_no_message = root
		}
		random_system = {
			limit = {
				has_star_flag = mem_colonizers_gate_system
			}
			save_event_target_as = gate_system
		}
	}

	option = {
		name = mem_colonizers.2.a
		trigger = {
			NOR = {
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_machine_terminator
				has_valid_civic = civic_hive_devouring_swarm
			}
		}
	}
	option = {
		name = mem_colonizers.2.b
		trigger = {
			OR = {
				has_ethic = ethic_xenophile
				has_ethic = ethic_fanatic_xenophile
				has_valid_civic = civic_machine_servitor
			}
		}
	}
	option = {
		name = mem_colonizers.2.c
		trigger = {
			OR = {
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
			}
			NOT = {
				has_valid_civic = civic_fanatic_purifiers
			}
		}
	}
	option = {
		name = mem_colonizers.2.d
		trigger = {
			has_valid_civic = civic_fanatic_purifiers
		}
	}
	option = {
		name = mem_colonizers.2.e
		trigger = {
			has_valid_civic = civic_hive_devouring_swarm
		}
	}
	option = {
		name = mem_colonizers.2.f
		trigger = {
			has_valid_civic = civic_machine_terminator
		}
	}
}

# custom diplo init.

country_event = {
	id = mem_colonizers.3
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		FROM = {
			is_country_type = mem_colonizers_dormant_country
		}
		NOT = {
			has_country_flag = mem_colonizers_diplo_engaged
		}
	}

	immediate = {
		FROM = { set_country_flag = colonizer_country }
		set_country_flag = mem_colonizers_diplo_engaged
		IF = {
			limit = { mem_is_jerk_country = no }
			country_event = { id = mem_colonizers.4 }
		}
		ELSE = {
			country_event = { id = mem_colonizers.7 }
		}
	}
}

# Custom diplo with them
country_event = {
	id = mem_colonizers.4
	title = MEM_COLONIZERS_HEADER
	desc = {
		text = mem_colonizers.4.desc.1
		trigger = {
		}
	}
	desc = {
		text = mem_colonizers.4.desc.2
		trigger = {
		}
	}
	desc = {
		text = mem_colonizers.4.desc.3
		trigger = {
		}
	}
	desc = {
		text = mem_colonizers.4.desc.4
		trigger = {
		}
	}

	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		room = mem_colonizers_room
	}

	

	option = {
		name = mem_colonizers.4.a
		default_hide_option = yes
		remove_country_flag = mem_colonizers_diplo_engaged
	}

	option = {
		name = mem_colonizers.4.b.1
		trigger = {
			NOT = { has_country_flag = mem_colonizers_discussed_trade_once }
		}
		hidden_effect = {
			country_event = { id = mem_colonizers.5 }
		}
	}
	option = {
		name = mem_colonizers.4.b.2
		trigger = {
			has_country_flag = mem_colonizers_discussed_trade_once
		}
		hidden_effect = {
			country_event = { id = mem_colonizers.5 }
		}
	}
	option = {
		name = mem_colonizers.4.c
		hidden_effect = {
			country_event = { id = mem_colonizers.6 }
		}
	}

	option = {
		name = mem_colonizers.4.d
		is_dialog_only = yes
		response_text = mem_colonizers.4.d.response
		set_country_flag = mem_colonizers_asked_to_see_face
		trigger = {
			NOT = {
				has_country_flag = mem_colonizers_asked_to_see_face
			}
		}
	}
	option = {
		name = mem_colonizers.4.e
		is_dialog_only = yes
		response_text = mem_colonizers.4.e.response
		set_country_flag = mem_colonizers_asked_what_endless_sea_means
		trigger = {
			NOT = {
				has_country_flag = mem_colonizers_asked_what_endless_sea_means
			}
		}
	}
	option = {
		name = mem_colonizers.4.f
		is_dialog_only = yes
		response_text = mem_colonizers.4.f.response
		set_country_flag = mem_colonizers_asked_what_native_means
		trigger = {
			NOT = {
				has_country_flag = mem_colonizers_asked_what_native_means
			}
		}
	}
}

# Discussing tribute
country_event = {
	id = mem_colonizers.5
	title = MEM_COLONIZERS_HEADER
	desc = {
		text = mem_colonizers.5.desc.1
		trigger = {
			NOT = { has_country_flag = mem_colonizers_discussed_trade_once }
		}
	}
	desc = {
		text = mem_colonizers.5.desc.2
		trigger = {
			has_country_flag = mem_colonizers_discussed_trade_once
		}
	}

	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		room = mem_colonizers_room
	}

	option = {
		name = mem_colonizers.5.a
		# remove_country_flag = mem_colonizers_diplo_engaged
		set_country_flag = mem_colonizers_discussed_trade_once
		hidden_effect = {
			country_event = { id = mem_colonizers.4 }
		}
	}

	option = {
		name = mem_colonizers.5.minerals.1
		trigger = {
			NOT = {
				event_target:colonizer_country = { has_country_flag = mem_colonizers_wants_minerals }
			}
		}
		allow = {
			resource_stockpile_compare = {
				resource = minerals
				value >= 3000
			}
		}

		add_resource = {
			minerals = -3000
		}
		mem_colonizers_roll_for_boons = yes
		remove_country_flag = mem_colonizers_diplo_engaged
	}
	option = {
		name = mem_colonizers.5.minerals.2
		trigger = {
			event_target:colonizer_country = { has_country_flag = mem_colonizers_wants_minerals }
		}
		allow = {
			resource_stockpile_compare = {
				resource = minerals
				value >= 4500
			}
		}

		add_resource = {
			minerals = -4500
		}
		mem_colonizers_roll_for_boons = yes
		remove_country_flag = mem_colonizers_diplo_engaged
	}

	option = {
		name = mem_colonizers.5.alloys.1
		trigger = {
			NOT = {
				event_target:colonizer_country = { has_country_flag = mem_colonizers_wants_alloys }
			}
		}
		allow = {
			resource_stockpile_compare = {
				resource = alloys
				value >= 1000
			}
		}

		add_resource = {
			alloys = -1000
		}
		mem_colonizers_roll_for_boons = yes
		remove_country_flag = mem_colonizers_diplo_engaged
	}
	option = {
		name = mem_colonizers.5.alloys.2
		trigger = {
			event_target:colonizer_country = { has_country_flag = mem_colonizers_wants_alloys }
		}
		allow = {
			resource_stockpile_compare = {
				resource = alloys
				value >= 1500
			}
		}

		add_resource = {
			alloys = -1500
		}
		mem_colonizers_roll_for_boons = yes
		remove_country_flag = mem_colonizers_diplo_engaged
	}

	option = {
		name = mem_colonizers.5.sr.1
		trigger = {
			NOT = {
				event_target:colonizer_country = { has_country_flag = mem_colonizers_wants_sr }
			}
		}
		allow = {
			resource_stockpile_compare = {
				resource = rare_crystals
				value >= 300
			}
			resource_stockpile_compare = {
				resource = volatile_motes
				value >= 300
			}
			resource_stockpile_compare = {
				resource = exotic_gases
				value >= 300
			}
		}

		add_resource = {
			rare_crystals = -300
			volatile_motes = -300
			exotic_gases = -300
		}
		mem_colonizers_roll_for_boons = yes
		remove_country_flag = mem_colonizers_diplo_engaged
	}
	option = {
		name = mem_colonizers.5.sr.2
		trigger = {
			event_target:colonizer_country = { has_country_flag = mem_colonizers_wants_sr }
		}
		allow = {
			resource_stockpile_compare = {
				resource = rare_crystals
				value >= 450
			}
			resource_stockpile_compare = {
				resource = volatile_motes
				value >= 450
			}
			resource_stockpile_compare = {
				resource = exotic_gases
				value >= 450
			}
		}

		add_resource = {
			rare_crystals = -450
			volatile_motes = -450
			exotic_gases = -450
		}
		mem_colonizers_roll_for_boons = yes
		remove_country_flag = mem_colonizers_diplo_engaged
	}

	option = {
		name = mem_colonizers.5.z
		default_hide_option = yes

		remove_country_flag = mem_colonizers_diplo_engaged
	}
}

# Discussing boon
country_event = {
	id = mem_colonizers.6
	title = MEM_COLONIZERS_HEADER
	desc = mem_colonizers.6.desc

	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		room = mem_colonizers_room
	}

	option = {
		name = mem_colonizers.6.a
		# remove_country_flag = mem_colonizers_diplo_engaged
		set_country_flag = mem_colonizers_discussed_trade_once
		hidden_effect = {
			country_event = { id = mem_colonizers.4 }
		}
	}

	option = {
		name = mem_colonizers.6.z
		default_hide_option = yes

		remove_country_flag = mem_colonizers_diplo_engaged
	}
}

# Purifier convo
country_event = {
	id = mem_colonizers.7
	title = MEM_COLONIZERS_HEADER
	desc = {
		text = mem_colonizers.7.desc.pur
		trigger = {
			has_valid_civic = civic_fanatic_purifiers
		}
	}
	desc = {
		text = mem_colonizers.7.desc.ter
		trigger = {
			has_valid_civic = civic_machine_terminator
		}
	}
	desc = {
		text = mem_colonizers.7.desc.swarm
		trigger = {
			has_valid_civic = civic_hive_devouring_swarm
		}
	}

	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		room = mem_colonizers_room
	}

	after = {
		remove_country_flag = mem_colonizers_diplo_engaged
	}

	option = {
		name = SCUM
		trigger = {
			has_valid_civic = civic_fanatic_purifiers
		}
	}
	option = {
		name = mem_colonizers.7.ter
		trigger = {
			has_valid_civic = civic_machine_terminator
		}
	}
	option = {
		name = mem_colonizers.7.swarm
		trigger = {
			has_valid_civic = civic_hive_devouring_swarm
		}
	}
}

# Test event
ship_event = {
	id = mem_colonizers.9999
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				save_event_target_as = project_location
				enable_special_project = {
					name = MEM_COLONIZERS_TEST
					location = THIS
					owner = ROOT
				}
			}
		}
		fleet = {
			fleet_action_research_special_project = {
				special_project = MEM_COLONIZERS_TEST
				target = event_target:project_location
			}
		}
	}
}

#####################
# MIDGAME EXPANSION #
#####################

# Pulse event to start the whole thing
event = {
	id = mem_colonizers.1000
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_country = {
			limit = {
				is_country_type = mem_colonizers_dormant_country
			}
			set_country_flag = mem_colonizers_begin_expansion
			save_event_target_as = colonizer_country
			country_event = { # Bounce to add an optional delay
				id = mem_colonizers.1001
			}
		}
	}
}

# Trigger to expand countries
country_event = {
	id = mem_colonizers.1001
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_country = {
			limit = {
				is_country_type = default
			}
			IF = {
				limit = {
					has_communications = root
				}
				country_event = {
					id = mem_colonizers.1002
				}
			}
			ELSE = {
				country_event = {
					id = mem_colonizers.1003
				}
			}
		}
	}
}

# Diplomatic event with those already in contact
country_event = {
	id = mem_colonizers.1002
	title = MEM_COLONIZERS_HEADER
	desc = mem_colonizers.1002.desc

	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		room = mem_colonizers_room
	}

	option = {
		name = WORRYING
	}
}

# Comms init
country_event = {
	id = mem_colonizers.1003
	title = mem_colonizers.1003.name
	desc = mem_colonizers.1003.desc

	is_triggered_only = yes

	# location = FROM
	picture = GFX_evt_federation_fleet
	show_sound = event_alien_signal

	option = {
		name = ONSCREEN
		add_resource = {
			influence = 30
		}
		hidden_effect = {
			establish_communications_no_message = event_target:colonizer_country
			country_event = {
				id = mem_colonizers.1004
			}
		}
	}
}

# Diplo greetings
country_event = {
	id = mem_colonizers.1004
	title = MEM_COLONIZERS_HEADER
	desc = mem_colonizers.1004.desc

	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		room = mem_colonizers_room
	}

	option = {
		name = mem_colonizers.2.a
		trigger = {
			NOR = {
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_machine_terminator
				has_valid_civic = civic_hive_devouring_swarm
			}
		}
	}
	option = {
		name = mem_colonizers.2.b
		trigger = {
			OR = {
				has_ethic = ethic_xenophile
				has_ethic = ethic_fanatic_xenophile
				has_valid_civic = civic_machine_servitor
			}
		}
	}
	option = {
		name = mem_colonizers.2.c
		trigger = {
			OR = {
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
			}
			NOT = {
				has_valid_civic = civic_fanatic_purifiers
			}
		}
	}
	option = {
		name = mem_colonizers.2.d
		trigger = {
			has_valid_civic = civic_fanatic_purifiers
		}
	}
	option = {
		name = mem_colonizers.2.e
		trigger = {
			has_valid_civic = civic_hive_devouring_swarm
		}
	}
	option = {
		name = mem_colonizers.2.f
		trigger = {
			has_valid_civic = civic_machine_terminator
		}
	}
}