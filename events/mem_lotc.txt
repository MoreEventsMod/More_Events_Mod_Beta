#Legacy of the Carcharorion
#AKA The Unponounceable Welsh event chain
#By ViolentBeetle

namespace = mem_lotc

ship_event = {
	id = mem_lotc.1
	title = "mem_lotc.1.name"
	desc = "mem_lotc.1.desc"
	picture = "GFX_evt_derelict_interior"
    is_triggered_only = yes

    immediate = {
    	owner = {
    		set_country_flag = mem_lotc_finder
			# leads to story event "Remnants" (first contact stuff)
			country_event = { id = story.5 days = 30 }
    	}
		
		from = {
			set_planet_flag = mem_lotc_start
			save_event_target_as = start
			solar_system = {
				set_star_flag = mem_lotc_start_system
			}
		}
    }

    option = {
        name = mem_lotc.1.a

        begin_event_chain = {
			event_chain = "mem_lotc_first_chain"
			target = root.owner
		}
        
        hidden_effect = {
            from.solar_system = {
                closest_system = {
                    limit = {
                        NOT = { has_star_flag = mem_lotc_used_as_spawner }
                    }
                    min_steps = 1
                    set_star_flag = mem_lotc_used_as_spawner
                    spawn_system = {
                        max_distance <= 20
                        min_distance >= 5
                        initializer = "mem_lotc_second_init"
                    }
                }
            }
        }

        random_system = {
            limit = {
                has_star_flag = mem_lotc_second
            }
            save_event_target_as = second_system
        }
        create_point_of_interest = {
            id = mem_lotc_poi.2
            name = "mem_lotc_poi.2"
            desc = "mem_lotc_poi.2.desc"
            event_chain = mem_lotc_first_chain
            location = event_target:second_system
        }
        owner = {
            set_country_flag = mem_lotc_going_for_it
        }
    }
    
    option = {
		name = NOTIME
		owner = { 
			add_resource = {
				influence = 250
			}
		}
	}
}

#First set: wet planet
fleet_event = {
	id = mem_lotc.2
	title = mem_lotc.2.name
	desc = mem_lotc.2.desc
	
	is_triggered_only = yes
	
    picture = GFX_evt_mem_horror_corridor
    archaeology = yes
    show_sound = event_finding_loot

    immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = { 
		from = { set_site_progress_locked = no } 
    }
	
	option = {
		name = mem_lotc.2a
		
		owner = {			
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
			
			# hidden_effect = {
			# 	country_event = { id = mem_lotc.11 }
			# }
		}
	}
}

#Cruiser action
#On action: Entering the second system, notified of the ship
ship_event = {
	id = mem_lotc.3
	title = mem_lotc.3.name
	desc = mem_lotc.3.desc
	picture = GFX_evt_ship_in_orbit
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			has_country_flag = mem_lotc_going_for_it
			NOT = { has_country_flag = mem_lotc_found_the_second }
		}
		from = {
			has_star_flag = mem_lotc_second
			NOT = { 
				any_ship_in_system = {
					has_ship_flag = mem_lotc_disabled_cruiser
				}
			}
		}
	}
	
	immediate = {
		owner = {
			set_country_flag = mem_lotc_found_the_second
			random_country = {
				limit = { has_country_flag = mem_lotc_theguys }
				establish_communications_no_message = prev
			}
		}
	}
	
	option = {
		name = OK
	}
}



#Third set: gas giant
fleet_event = {
	id = mem_lotc.4
	title = mem_lotc.4.name
	desc = mem_lotc.4.desc
	
	is_triggered_only = yes
	
    picture = GFX_evt_mem_hive_cities
    archaeology = yes
    show_sound = event_finding_loot

    immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = { 
		from = { set_site_progress_locked = no } 
    }
	
	option = {
		name = mem_lotc.4a
		
		owner = {
			
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
			
			# hidden_effect = {
			# 	country_event = { id = mem_lotc.11 }
			# }
		}
	}
}

#Fourth set: barren
fleet_event = {
	id = mem_lotc.5
	title = mem_lotc.5.name
	desc = mem_lotc.5.desc
	
	is_triggered_only = yes
	
    picture = GFX_evt_mining_operations
    archaeology = yes
    show_sound = event_finding_loot

    immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = { 
		from = { set_site_progress_locked = no } 
    }
	
	option = {
		name = mem_lotc.5a
	}
}

#Ship disabled: Event for NPC
ship_event = {
	id = mem_lotc.6
	
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_ship_flag = mem_lotc_cruiser
	}
	
	immediate = {
		set_ship_flag = mem_lotc_disabled_cruiser
		IF = {
			limit = {
				from.owner = {
					has_country_flag = mem_lotc_going_for_it
				}
			}
			from.owner = {
				set_country_flag = mem_lotc_shot_cruiser
				country_event = {
					id = mem_lotc.7
				}
			}
		}
		ELSE_IF = {
			limit = {
				any_country = {
					has_country_flag = mem_lotc_found_the_second
				}
			}
			every_country = {
				limit = {
					has_country_flag = mem_lotc_found_the_second
				}
				country_event = {
					id = mem_lotc.8
				}
			}
		}
	}
}

#Notified, if the player shot it
country_event = {
	id = mem_lotc.7
	title = mem_lotc.7.name
	desc = mem_lotc.7.desc
	
	is_triggered_only = yes
	
	picture = GFX_evt_exploding_ship
	
	option = {
		name = mem_lotc.7a
		
		from = {
			enable_special_project = {
				name = "MEM_LOTC_BOARDING_CRUISER"
				location = this
				owner = root
			}
		}
		
		hidden_effect = {
			remove_point_of_interest = mem_lotc_poi.2
		}
	}
}

#Notified, player didn't take it out, but was aware of it
country_event = {
	id = mem_lotc.8
	title = mem_lotc.8.name
	desc = mem_lotc.8.desc
	
	is_triggered_only = yes
	
	picture = GFX_evt_exploding_ship
	
	option = {
		name = mem_lotc.8a
		
		from = {
			enable_special_project = {
				name = "MEM_LOTC_BOARDING_CRUISER"
				location = this
				owner = root
			}
		}
		
		hidden_effect = {
			remove_point_of_interest = mem_lotc_poi.2
		}
	}
}

#on_action: Entered the system and found ship disabled
ship_event = {
	id = mem_lotc.9
	title = mem_lotc.9.name
	desc = mem_lotc.9.desc
	picture = GFX_evt_ship_in_orbit
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			has_country_flag = mem_lotc_going_for_it
			NOT = { has_country_flag = mem_lotc_found_the_second }
		}
		from = {
			has_star_flag = mem_lotc_second
			
			any_ship_in_system = {
				has_ship_flag = mem_lotc_disabled_cruiser
			}
			
		}
	}
	
	immediate = {
		owner = {
			set_country_flag = mem_lotc_found_the_second
			random_country = {
				limit = { has_country_flag = mem_lotc_theguys }
				establish_communications_no_message = prev
			}
		}
	}
	
	option = {
		name = mem_lotc.9a
		
		from = {
			random_fleet_in_system = {
				limit = {
					has_fleet_flag = mem_lotc_cruiser
				}
				
				enable_special_project = {
					name = "MEM_LOTC_BOARDING_CRUISER"
					location = this
					owner = root
				}
			}
		}
		
		hidden_effect = {
			owner = {
				remove_point_of_interest = mem_lotc_poi.2
			}
		}
	}
}

#Boarding complete
ship_event = {
	id = mem_lotc.10
	title = mem_lotc.10.name
	desc = mem_lotc.10.desc
	
	is_triggered_only = yes
	
	picture = GFX_evt_interior_battle
	
	immediate = {
		solar_system = { 
			random_fleet_in_system = {
				limit = { has_fleet_flag = mem_lotc_cruiser }
				destroy_fleet = this
			}
		}
	}
	
	option = {
		name = mem_lotc.10a
		
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
			hidden_effect = {
				set_country_flag = mem_lotc_reveal_the_city_site
			}
		}
	}
}