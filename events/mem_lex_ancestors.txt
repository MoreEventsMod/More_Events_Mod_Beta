namespace = mem_ancestor

# Ancestor Crisis - Children of Azoth
# Code & idea by Frog, writing by Cc

# Swarm generated on ship destruction

country_event = {
	id = mem_ancestor.1
	
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		FROMFROM = {
			OR = {
				is_ship_size = mem_apostle_1
				is_ship_size = mem_apostle_2
				is_ship_size = mem_apostle_3
				is_ship_size = mem_apostle_4
				is_ship_size = mem_apostle_egg
				is_ship_size = mem_apostle_child
				is_ship_size = mem_apostle_scout
				is_ship_size = mem_apostle_station
				is_ship_size = mem_apostle_xxl_cloud
				is_ship_size = mem_apostle_xl_cloud
				is_ship_size = mem_apostle_l_cloud
				is_ship_size = mem_apostle_m_cloud
				is_ship_size = mem_apostle_s_cloud
			}
		}
	}
	
	immediate = {
		FROMFROM = {
			solar_system = {
				random_system_planet = {
					limit = { is_star = yes }
					save_event_target_as = mem_ancestor_spawn
				}
			}
			owner = {
				save_event_target_as = mem_ancestor_swarm_owner
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					NOR = {
						is_ship_size = corvette
						is_ship_size = destroyer
						is_ship_size = cruiser
						is_ship_size = battleship
						is_ship_size = constructor
						is_ship_size = colonizer
						is_ship_size = science
						is_ship_size = transport
						is_ship_size = military_station_small
						is_ship_size = military_station_medium
						is_ship_size = military_station_large
						is_ship_size = orbital_station
						is_ship_size = mining_station
						is_ship_size = research_station
						is_ship_size = wormhole_station
						is_ship_size = observation_station
						is_ship_size = outpost_station
					}
				}
			}
			if = {
				limit = {
					FROMFROMFROM = {
						is_ship_class = shipclass_transport
					}
				}
				random_list = {
					50 = {
						mem_ancestor_infant = yes
						last_created_fleet = {
							mem_effect_explosion_7 = yes
						}
						break = yes
					}
					50 = {
						break = yes
					}
				}
			}
			if = {
				limit = {
					FROMFROMFROM = {
						is_ship_class = shipclass_constructor
					}
				}
				random_list = {
					50 = {
						mem_ancestor_young = yes
						last_created_fleet = {
							mem_effect_explosion_7 = yes
						}
						break = yes
					}
					50 = {
						break = yes
					}
				}
			}
			if = {
				limit = {
					FROMFROMFROM = {
						is_ship_class = shipclass_science_ship
					}
				}
				random_list = {
					50 = {
						mem_ancestor_adult = yes
						last_created_fleet = {
							mem_effect_explosion_7 = yes
						}
						break = yes
					}
					50 = {
						break = yes
					}
				}
			}
			if = {
				limit = {
					FROMFROMFROM = {
						is_ship_class = shipclass_colonizer
					}
				}
				random_list = {
					50 = {
						mem_ancestor_elder = yes
						last_created_fleet = {
							mem_effect_explosion_7 = yes
						}
						break = yes
					}
					50 = {
						break = yes
					}
				}
			}
			if = {
				limit = {
					FROMFROMFROM = {
						OR = {
							is_ship_class = shipclass_military
							is_ship_class = shipclass_military_station
						}
					}
				}
				random_list = {
					10 = {
						mem_ancestor_infant = yes
						last_created_fleet = {
							mem_effect_explosion_7 = yes
						}
						break = yes
					}
					10 = {
						mem_ancestor_young = yes
						last_created_fleet = {
							mem_effect_explosion_7 = yes
						}
						break = yes
					}
					10 = {
						mem_ancestor_adult = yes
						last_created_fleet = {
							mem_effect_explosion_7 = yes
						}
						break = yes
					}
					10 = {
						mem_ancestor_elder = yes
						last_created_fleet = {
							mem_effect_explosion_7 = yes
						}
						break = yes
					}
					10 = {
						mem_ancestor_immortal = yes
						last_created_fleet = {
							mem_effect_explosion_7 = yes
						}
						break = yes
					}
					50 = {
						break = yes
					}
				}
				
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = corvette
				}
			}
			random_list = {
				50 = {
					mem_ancestor_infant = yes
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = destroyer
				}
			}
			random_list = {
				50 = {
					mem_ancestor_young = yes
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = cruiser
				}
			}
			random_list = {
				50 = {
					mem_ancestor_adult = yes
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = battleship
				}
			}
			random_list = {
				50 = {
					mem_ancestor_elder = yes
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = transport
				}
			}
			random_list = {
				50 = {
					mem_ancestor_infant = yes
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = constructor
				}
			}
			random_list = {
				50 = {
					mem_ancestor_young = yes
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = science
				}
			}
			random_list = {
				50 = {
					mem_ancestor_adult = yes
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = colonizer
				}
			}
			random_list = {
				50 = {
					mem_ancestor_elder = yes
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = wormhole_station
				}
			}
			random_list = {
				50 = {
					mem_ancestor_infant = yes
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = mining_station
				}
			}
			random_list = {
				50 = {
					mem_ancestor_young = yes
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = research_station
				}
			}
			random_list = {
				50 = {
					mem_ancestor_adult = yes
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = observation_station
				}
			}
			random_list = {
				50 = {
					mem_ancestor_elder = yes
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = military_station_small
				}
			}
			random_list = {
				50 = {
					mem_ancestor_infant = yes
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = military_station_medium
				}
			}
			random_list = {
				50 = {
					mem_ancestor_young = yes
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = military_station_large
				}
			}
			random_list = {
				50 = {
					mem_ancestor_adult = yes
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = outpost_station
				}
			}
			random_list = {
				50 = {
					mem_ancestor_elder = yes
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = orbital_station
				}
			}
			random_list = {
				50 = {
					mem_ancestor_immortal = yes
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
				}
				50 = {
				}
			}
		}
	}	
}

# Swarm downgrade and split on death

country_event = {
	id = mem_ancestor.2
	
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		FROMFROMFROM = {
			OR = {
				is_ship_size = mem_apostle_4
				is_ship_size = mem_apostle_scout
				is_ship_size = mem_apostle_xxl_cloud
				is_ship_size = mem_apostle_xl_cloud
				is_ship_size = mem_apostle_l_cloud
				is_ship_size = mem_apostle_m_cloud
			}
		}
	}
	
	immediate = {
		FROMFROMFROM = {
			owner = {
				save_event_target_as = mem_ancestor_swarm_owner_1
			}
		}
		FROMFROM = {
			solar_system = {
				random_system_planet = {
					limit = { is_star = yes }
					save_event_target_as = mem_ancestor_spawn_1
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = mem_apostle_4
				}
			}
			while = {
				count = 8
				mem_ancestor_immortal_1 = yes
			}
			last_created_fleet = {
				mem_effect_explosion_7 = yes
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = mem_apostle_scout
				}
			}
			while = {
				count = 4
				mem_ancestor_immortal_1 = yes
			}
			last_created_fleet = {
				mem_effect_explosion_7 = yes
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = mem_apostle_station
				}
			}
			while = {
				count = 2
				mem_ancestor_immortal_1 = yes
			}
			last_created_fleet = {
				mem_effect_explosion_7 = yes
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = mem_apostle_xxl_cloud
				}
			}
			random_list = {
				50 = {
					while = {
						count = 2
						mem_ancestor_elder_1 = yes
					}
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = mem_apostle_xl_cloud
				}
			}
			random_list = {
				50 = {
					while = {
						count = 2
						mem_ancestor_adult_1 = yes
					}
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = mem_apostle_l_cloud
				}
			}
			random_list = {
				50 = {
					while = {
						count = 2
						mem_ancestor_young_1 = yes
					}
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = mem_apostle_m_cloud
				}
			}
			random_list = {
				50 = {
					while = {
						count = 2
						mem_ancestor_infant_1 = yes
					}
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
				}
				50 = {
				}
			}
		}	
	}
}

# Leviathan evolves

country_event = {
	id = mem_ancestor.3
	
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_country_type = mem_ancestor_guardian
		has_country_flag = mem_ancestor_country
		NOT = {
			AND = {
				has_country_flag = mem_ancestor_evolve_1
				has_country_flag = mem_ancestor_evolve_2
				has_country_flag = mem_ancestor_evolve_3
				has_country_flag = mem_ancestor_evolve_4
			}
		}
		any_owned_ship = {
			OR = {
				is_ship_size = mem_apostle_1
				is_ship_size = mem_apostle_2
				is_ship_size = mem_apostle_3
				is_ship_size = mem_apostle_egg
			}
		}
	}
	
	immediate = {
		FROMFROM = {
			OWNER = {
				save_event_target_as = mem_ancestor_evolve_owner
			}
			save_event_target_as = mem_ancestor_evolve_spawn
		}
		if = {
			limit = {
				FROMFROM = {
					OWNER = {
						NOT = { has_country_flag = mem_ancestor_evolve_1 }
						count_owned_ships = {
							limit = {
								is_ship_size = mem_apostle_1
								FLEET = { is_same_value = event_target:mem_ancestor_evolve_spawn }
							}
							count > 0
						}
						num_owned_planets > 15
					}
				}
			}
			mem_ancestor_fanu_1 = yes
			FROMFROM = {
				OWNER = {
					add_modifier = {
						modifier = "mem_ancestor_buff_1"
						days = -1
					}
				}
				delete_fleet = this
			}
			last_created_fleet = {
				mem_effect_explosion_8 = yes
			}
			set_country_flag = mem_ancestor_evolve_1
			every_country = {
				limit = {
					is_ai = no
					is_country_type = default
				}
				country_event = { id = mem_ancestor.45 days = 10 }
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					OWNER = {
						has_country_flag = mem_ancestor_evolve_1
						NOT = { has_country_flag = mem_ancestor_evolve_2 }
						count_owned_ships = {
							limit = {
								is_ship_size = mem_apostle_2
								FLEET = { is_same_value = event_target:mem_ancestor_evolve_spawn }
							}
							count > 0
						}
						num_owned_planets > 30
					}
				}
			}
			mem_ancestor_fanu_2 = yes
			FROMFROM = {
				OWNER = {
					add_modifier = {
						modifier = "mem_ancestor_buff_2"
						days = -1
					}
				}
				delete_fleet = this
			}
			last_created_fleet = {
				mem_effect_explosion_8 = yes
			}
			set_country_flag = mem_ancestor_evolve_2
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					OWNER = {
						AND = {
							has_country_flag = mem_ancestor_evolve_1
							has_country_flag = mem_ancestor_evolve_2
						}
						NOT = { has_country_flag = mem_ancestor_evolve_3 }
						count_owned_ships = {
							limit = {
								is_ship_size = mem_apostle_3
								FLEET = { is_same_value = event_target:mem_ancestor_evolve_spawn }
							}
							count > 0
						}
						num_owned_planets > 45
					}
				}
			}
			mem_ancestor_fanu_3 = yes
			mem_ancestor_thesan_1 = yes
			FROMFROM = {
				OWNER = {
					add_modifier = {
						modifier = "mem_ancestor_buff_3"
						days = -1
					}
				}
				delete_fleet = this
			}
			last_created_fleet = {
				mem_effect_explosion_8 = yes
			}
			set_country_flag = mem_ancestor_evolve_3
			every_country = {
				limit = {
					is_ai = no
					is_country_type = default
				}
				country_event = { id = mem_ancestor.46 days = 10 }
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					OWNER = {
						AND = {
							has_country_flag = mem_ancestor_evolve_1
							has_country_flag = mem_ancestor_evolve_2
							has_country_flag = mem_ancestor_evolve_3
						}
						NOT = { has_country_flag = mem_ancestor_evolve_4 }
						count_owned_ships = {
							limit = {
								is_ship_size = mem_apostle_egg
								FLEET = { is_same_value = event_target:mem_ancestor_evolve_spawn }
							}
							count > 0
						}
						num_owned_planets > 60
					}
				}
			}
			mem_ancestor_thesan_2 = yes
			FROMFROM = {
				OWNER = {
					add_modifier = {
						modifier = "mem_ancestor_buff_4"
						days = -1
					}
				}
				delete_fleet = this
			}
			last_created_fleet = {
				mem_effect_explosion_8 = yes
			}
			set_country_flag = mem_ancestor_evolve_4
			break = yes
		}
	}
}

# Swarm evolves

fleet_event = {
	id = mem_ancestor.4
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		THIS = {
			OWNER = {
				save_event_target_as = mem_ancestor_swarm_owner_2
			}
			save_event_target_as = mem_ancestor_spawn_2
		}
		if = {
			limit = {
				has_fleet_flag = mem_ancestor_infant_spawn
			}
			mem_ancestor_young_2 = yes
			last_created_fleet = {
				mem_effect_explosion_7 = yes
			}
			destroy_fleet = THIS
			break = yes
		}
		if = {
			limit = {
				has_fleet_flag = mem_ancestor_young_spawn
			}
			mem_ancestor_adult_2 = yes
			last_created_fleet = {
				mem_effect_explosion_7 = yes
			}
			destroy_fleet = THIS
			break = yes
		}
		if = {
			limit = {
				has_fleet_flag = mem_ancestor_adult_spawn
			}
			mem_ancestor_elder_2 = yes
			last_created_fleet = {
				mem_effect_explosion_7 = yes
			}
			destroy_fleet = THIS
			break = yes
		}
		if = {
			limit = {
				has_fleet_flag = mem_ancestor_elder_spawn
			}
			mem_ancestor_immortal_2 = yes
			last_created_fleet = {
				mem_effect_explosion_7 = yes
			}
			destroy_fleet = THIS
			break = yes
		}
		if = {
			limit = {
				has_fleet_flag = mem_ancestor_dying_spawn
			}
			random_list = {
				25 = {
					mem_ancestor_infant_2 = yes
					last_created_fleet = {
						mem_effect_explosion_7 = yes
					}
					destroy_fleet = THIS
					break = yes
				}
				75 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				has_fleet_flag = mem_ancestor_boss_decay
			}
			while = {
				count = 16
				mem_ancestor_immortal_2 = yes
			}
			last_created_fleet = {
				mem_effect_explosion_7 = yes
			}
			destroy_fleet = THIS
			break = yes
		}
	}
}

# Planet conversion

planet_event = {
	id = mem_ancestor.5
	hide_window = yes
	
	trigger = {
		FROM = {
			is_country_type = mem_ancestor_guardian
		}
	}
	
	is_triggered_only = yes
	
	immediate = {
		add_threat = {
			who = from
			amount = 100
		}
		from = {
			save_event_target_as = mem_ancestor_swarm_owner_3
		}
		this = {
			solar_system = {
				if = {
					limit = {
						NOT = {
							any_ship_in_system = { 
								is_ship_size = mem_apostle_station
							}
						}
					}
					random_system_planet = {
						limit = { is_star = yes }
						save_event_target_as = mem_ancestor_spawn_3
						mem_ancestor_ward = yes
					}
				}
			}
		}
		create_ambient_object = {
			type = mem_effect_explosion_6_object
			location = THIS
			duration = 10
				
			use_3d_location = yes
				
			entity_offset = { min = 0 max = 0 }
			entity_offset_angle = { min = 0 max = 0 }
			entity_offset_height = { min = 0 max = 0 }
				
			entity_scale_to_size = yes
			scale = 100
		}
		random_list = {
			25 = {
				create_ambient_object = {
				type = "small_debris_object"
				location = THIS
				}
			}
			25 = {
				create_ambient_object = {
				type = "medium_debris_01_object"
				location = THIS
				}
			}
			25 = {
				create_ambient_object = {
				type = "medium_debris_02_object"
				location = THIS
				}
			}
			25 = {
				create_ambient_object = {
				type = "large_debris_object"
				location = THIS
				}
			}
		}
		OWNER = {
			country_event = { id = mem_ancestor.47 days = 10 }
		}
		if = {
			limit = {
				NOT = {
					OR = {
						is_planet_class = pc_ringworld_habitable 
						is_planet_class = pc_mem_ringworld_habitable 
						has_planet_flag = fallen_empire_world
						has_modifier = holy_planet
					}
				}
			}
			destroy_colony = yes
			if = {
				limit = {
					NOT = {
						is_planet_class = pc_gaia
					}
				}
				change_pc = pc_gaia
			}
			mem_ancestor_terraform = yes
			set_owner = event_target:mem_ancestor_swarm_owner_3
			set_planet_flag = mem_ancestor_world
			remove_planet_flag = mem_ancestor_touched
			every_tile = {
				set_blocker = tb_mem_nature
			}
			add_resource = { 
				resource = sr_alien_pets
				amount = 1 
			}
			add_modifier = {
				modifier = "mem_ancestor_garden_world"
				days = -1
			}
			planet_event = { id = mem_ancestor.200 }
			break = yes
		}
		if = {
			limit = {
					has_planet_flag = fallen_empire_world
					NOT = {
						is_planet_class = pc_ringworld_habitable
					}
			}
			destroy_colony = yes
			change_pc = pc_nuked
			remove_planet_flag = mem_ancestor_touched
			mem_ancestor_terraform = yes
			every_tile = {
				if = {
					limit = {
						has_building = yes
					}
					set_building = mem_building_crisis_ruin
				}
			}
			add_resource = { 
				resource = sr_betharian
				amount = 1
			}
			break = yes
		}
		if = {
			limit = {
				has_modifier = holy_planet 
			}
			destroy_colony = yes
			change_pc = pc_mem_cracked	
			mem_ancestor_terraform = yes
			set_planet_max_health = 0
			add_resource = { 
				resource = sr_dark_matter
				amount = 1
			}
			break = yes
		}
		if = {
			limit = {
				OR = {
					is_planet_class = pc_ringworld_habitable 
					is_planet_class = pc_mem_ringworld_habitable 
				}
			}
			destroy_colony = yes
			change_pc = pc_ringworld_habitable_damaged
			mem_ancestor_terraform = yes
			set_planet_max_health = 0
			add_resource = { 
				resource = sr_living_metal
				amount = 1
			}
			break = yes
		}
		if = {
			limit = {
				is_planet_class = pc_habitat
			}
			destroy_colony = yes
			remove_planet = yes 
		}
	}
}

# Player planet reclamation

planet_event = {
	id = mem_ancestor.6
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_planet_flag = mem_ancestor_world
	}
	
	immediate = {
		THIS = {
			solar_system = {
				random_system_planet = {
					limit = { is_star = yes }
					save_event_target_as = mem_ancestor_spawn_4
				}
			}
			OWNER = {
				save_event_target_as = mem_ancestor_swarm_owner_4
				add_modifier = {
					modifier = "mem_ancestor_world_debuff"
					days = 360
				}
			}
		}
		mem_ancestor_immortal_3 = yes
		destroy_colony = yes
		set_planet_max_health = 0
		remove_planet_flag = mem_ancestor_world
		if = {
			limit = {
				has_modifier = mem_ancestor_garden_world
			}
			remove_modifier = "mem_ancestor_garden_world"
		}
		random_list = {
			75 = {
				every_tile = {
					if = {
						limit = {
							has_blocker = "tb_mem_nature"
						}
						remove_blocker = yes
					}
				}
			}
			25 = {
				if = {
					limit = {
						OR = {
							is_planet_class = pc_ringworld_habitable 
							is_planet_class = pc_mem_ringworld_habitable 
						}
					}
					change_pc = pc_ringworld_habitable_damaged
					else = {
						random_list = {
							25 = { change_pc = pc_nuked }
							25 = { change_pc = pc_toxic }
							25 = { change_pc = pc_molten }
							25 = { change_pc = pc_barren }
						}
					}
					FROM = {
						country_event = { id = mem_ancestor.48 days = 10 }
					}
				}
			}
		}
		create_ambient_object = {
			type = mem_effect_explosion_6_object
			location = THIS
			duration = 10
				
			use_3d_location = yes
				
			entity_offset = { min = 0 max = 0 }
			entity_offset_angle = { min = 0 max = 0 }
			entity_offset_height = { min = 0 max = 0 }
				
			entity_scale_to_size = yes
			scale = 100
		}
		planet_event = { id = mem_ancestor.201 }
	}
}

planet_event = {
	id = mem_ancestor.7
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			is_country_type = mem_ancestor_guardian
		}
	}
	
	immediate = {
		if = {
			limit = {
				NOT = {
					has_planet_flag = mem_ancestor_touched
				}
			}
			set_planet_flag = mem_ancestor_touched
		}
		random_list = {
			50 = {
				if = {
					limit = {
						count_pops = {
							count > 1
						}
					}						
					random_pop = {
						limit = {
							NOT = {
								has_modifier = mem_pop_ancestor
								is_growing = yes 
							}
						}
						add_modifier = {
							modifier = "mem_pop_ancestor"
							days = -1
						}
					}
					add_threat = {
						who = FROM
						amount = 10
					}
				}
			}
			50 = {
			}
		}
		random_list = {
			50 = {
				if = {
					limit = {
						count_pops = {
							count > 1
						}
						any_pop = {
							has_modifier = mem_pop_ancestor
						}
					}
					FROM = {
						country_event = { id = action.23 }
						save_event_target_as = mem_ancestor_swarm_owner_6
					}							
					random_pop = {
						limit = {
							has_modifier = mem_pop_ancestor
						}
						kill_pop = yes
					}
					THIS = {
						solar_system = {
							random_system_planet = {
								limit = {
									is_star = yes
								}
								save_event_target_as = mem_ancestor_spawn_6
							}
						}
					}
					mem_ancestor_infant_6 = yes
					add_threat = {
						who = FROM
						amount = 10
					}
				}
			}
			50 = {
			}
		}
		random_list = {
			50 = {
				if = {
					limit = {
						count_pops = {
							count > 1
						}
					}						
					random_planet_army = {
						limit = {
							exists = this
						}
						remove_army = yes  
					}
					add_threat = {
						who = FROM
						amount = 10
					}
				}
			}
			50 = {
			}
		}
		random_list = {
			50 = {
				random_tile = {
					limit = {
						has_building = yes
						is_ruined = no
					}
					set_ruined = yes
				}
				add_threat = {
					who = FROM
					amount = 10
				}
			}
			50 = {
			}
		}
		random_list = {
			50 = {
				if = {
					limit = {
						planet = {
							count_pops = {
								count > 1
							}
						}
					}
					random_tile = {
						limit = {
							has_grown_pop = no
							has_growing_pop = no 
							has_blocker = no
							has_building = yes
							is_ruined = yes
						}
						set_blocker = "tb_mem_nature"
					}
					add_threat = {
						who = FROM
						amount = 10
					}
				}
			}
			50 = {
			}
		}
		random_list = {
			50 = {	
				if = {
					limit = {
						planet = {
							count_pops = {
								count > 1
							}
						}
					}
					random_tile = {
						limit = {
							has_grown_pop = no
							has_growing_pop = no 
							has_blocker = no
							has_building = no
						}
						set_blocker = "tb_mem_nature"
					}
					add_threat = {
						who = FROM
						amount = 10
					}
				}
			}
			50 = {
			}
		}
	}
}

#Crisis galaxy wide effect - convert touched planets

event = {
	id = mem_ancestor.8
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = mem_ancestor_crisis_start
		NOT = {
		 has_global_flag = mem_ancestor_crisis_end
		}
	}

	immediate = {
		every_planet = {
			if = {
				limit = {
					num_pops > 0
					AND = {
						solar_system = {
							any_ship_in_system = {
								OR = {
									is_ship_size = mem_apostle_1
									is_ship_size = mem_apostle_2
									is_ship_size = mem_apostle_3
									is_ship_size = mem_apostle_4
									is_ship_size = mem_apostle_egg
									is_ship_size = mem_apostle_child
									is_ship_size = mem_apostle_scout
									is_ship_size = mem_apostle_station
									is_ship_size = mem_apostle_xxl_cloud
									is_ship_size = mem_apostle_xl_cloud
									is_ship_size = mem_apostle_l_cloud
									is_ship_size = mem_apostle_m_cloud
								}
							}
						}
						NOT = {
							has_modifier = mem_ancestor_in_system
						}
					}
				}
				add_modifier = {
					modifier = "mem_ancestor_in_system"
					days = 30
				}
			}
			if = {
				limit = {
					num_pops = 0
					has_planet_flag = mem_ancestor_touched
					NOT = {
						has_planet_flag = mem_ancestor_world
						OR = {
							is_planet_class = pc_ringworld_habitable 
							is_planet_class = pc_mem_ringworld_habitable 
							has_planet_flag = fallen_empire_world
							has_modifier = holy_planet
						}
					}
				}
				mem_ancestor_delayed_conversion = yes
				mem_ancestor_terraform = yes
				change_pc = pc_gaia
				set_owner = event_target:mem_ancestor_country
				set_planet_flag = mem_ancestor_world
				remove_planet_flag = mem_ancestor_touched
				every_tile = {
					set_blocker = tb_mem_nature
				}
				add_resource = { 
					resource = sr_alien_pets
					amount = 1 
				}
				add_modifier = {
					modifier = "mem_ancestor_garden_world"
					days = -1
				}
				add_threat = {
					who = event_target:mem_ancestor_country
					amount = 100
				}
				planet_event = { id = mem_ancestor.200 }
			}
			if = {
				limit = {
					num_pops = 0
					AND = {
						has_planet_flag = fallen_empire_world
						has_planet_flag = mem_ancestor_touched
					}
					NOT = {
						is_planet_class = pc_nuked
						has_planet_flag = mem_ancestor_world
						OR = {
							is_planet_class = pc_ringworld_habitable
							is_planet_class = pc_ringworld_habitable_damaged
						}
					}
				}
				mem_ancestor_delayed_conversion = yes
				mem_ancestor_terraform = yes
				change_pc = pc_nuked
				remove_planet_flag = mem_ancestor_touched
				every_tile = {
					if = {
						limit = {
							has_building = yes
						}
						set_building = mem_building_crisis_ruin
					}
				}
				add_resource = { 
					resource = sr_betharian
					amount = 1
				}
				add_threat = {
					who = event_target:mem_ancestor_country
					amount = 100
				}
			}
			if = {
				limit = {
					num_pops = 0
					AND = {
						has_modifier = holy_planet 
						has_planet_flag = mem_ancestor_touched
					}
					NOT = {
						is_planet_class = pc_mem_cracked
						has_planet_flag = mem_ancestor_world
					}
				}
				mem_ancestor_delayed_conversion = yes
				mem_ancestor_terraform = yes
				change_pc = pc_mem_cracked	
				remove_planet_flag = mem_ancestor_touched
				set_planet_max_health = 0
				add_resource = { 
					resource = sr_dark_matter
					amount = 1
				}
				add_threat = {
					who = event_target:mem_ancestor_country
					amount = 100
				}
			}
			if = {
				limit = {
					num_pops = 0
					has_planet_flag = mem_ancestor_touched
					OR = {
						is_planet_class = pc_ringworld_habitable 
						is_planet_class = pc_mem_ringworld_habitable 
					}
					NOT = {
						is_planet_class = pc_ringworld_habitable_damaged
						has_planet_flag = mem_ancestor_world
					}
				}
				mem_ancestor_delayed_conversion = yes
				mem_ancestor_terraform = yes
				change_pc = pc_ringworld_habitable_damaged
				remove_planet_flag = mem_ancestor_touched
				set_planet_max_health = 0
				add_resource = { 
					resource = sr_living_metal
					amount = 1
				}
				add_threat = {
					who = event_target:mem_ancestor_country
					amount = 100
				}
			}
			if = {
				limit = {
					num_pops = 0
					has_planet_flag = mem_ancestor_touched
					is_planet_class = pc_habitat
				}
				mem_ancestor_delayed_conversion = yes
				remove_planet = yes 
				add_threat = {
					who = event_target:mem_ancestor_country
					amount = 100
				}
			}
		}
	}
}

fleet_event = {
	id = mem_ancestor.9
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		queue_actions = {
			repeat = {
				max_iterations = 1
				find_closest_system = {
					trigger = {
						id = mem_ancestor_monstrosity.roam.1
						OR = {
							any_ship_in_system = {
								exists = owner
								NOT = {
									owner = {
										is_same_value = event_target:mem_ancestor_country
									}
								}
							}
							AND = {
								exists = space_owner
								any_planet = {
									OR = {
										has_spaceport = yes  
										has_observation_outpost = yes
										has_mining_station = yes
										has_research_station = yes 
									}
								}
								NOT = {
									space_owner = {
										is_same_value = event_target:mem_ancestor_country
									}
								}
							}
						}
						NOT = {
							OR = {
								has_star_flag = guardian
								has_star_flag = mem_ring_system
								has_star_flag = mem_grave_system
								has_star_flag = mem_garden_system
								has_star_flag = mem_prison_system
							}
							any_ship_in_system = {
								is_ship_size = mem_apostle_xxl_cloud 
							}
						}
					}
					found_system = {
						move_to = this
						
						find_closest_planet = {
							trigger = {
								id = mem_ancestor_monstrosity.roam.2
								OR = {
									is_star = yes
									has_spaceport = yes  
									has_observation_outpost = yes
									has_mining_station = yes
									has_research_station = yes 
								}
							}
							found_planet = {
								move_to = this
								wait = {
									duration = 25
									random = 15
								}
							}
						}
					}
				}
			}
		}
	}
}

fleet_event = {
	id = mem_ancestor.10
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		queue_actions = {
			repeat = {
				find_random_system = {
					trigger = {
						id = mem_ancestor_herald.roam.1a
						OR = {
							any_ship_in_system = {
								exists = owner
								NOT = {
									owner = {
										is_same_value = event_target:mem_ancestor_country
									}
								}
							}
							AND = {
								exists = space_owner
								any_planet = {
									OR = {
										has_spaceport = yes  
										has_observation_outpost = yes
										has_mining_station = yes
										has_research_station = yes 
									}
								}
								NOT = {
									space_owner = {
										is_same_value = event_target:mem_ancestor_country
									}
								}
							}
						}
						NOT = {
							OR = {
								has_star_flag = guardian
								has_star_flag = mem_ring_system
								has_star_flag = mem_grave_system
								has_star_flag = mem_garden_system
								has_star_flag = mem_prison_system
							}
							any_ship_in_system = {
								OR = {
									is_ship_size = mem_titan
									is_ship_size = mem_grave_awakened_pc
									is_ship_size = mem_conduit_avatar
									is_ship_size = mem_apostle_scout 
									is_ship_size = mem_apostle_1
									is_ship_size = mem_apostle_2
									is_ship_size = mem_apostle_3
									is_ship_size = mem_apostle_4
									is_ship_size = mem_apostle_egg
									is_ship_size = mem_apostle_child
								}
							}
						}
					}
					found_system = {
						move_to = this
						
						find_closest_planet = {
							trigger = {
								id = mem_ancestor_herald.roam.1b
								OR = {
									is_star = yes
									has_spaceport = yes  
									has_observation_outpost = yes
									has_mining_station = yes
									has_research_station = yes 
								}
							}
							found_planet = {
								move_to = this
								wait = {
									duration = 45
									random = 25
								}
							}
						}
					}
				}
			}
		}
	}
}

fleet_event = {
	id = mem_ancestor.11
	hide_window = yes
	
	trigger = {
		any_combatant_fleet = {
			exists = owner
			owner = {
				is_country_type = mem_ancestor_guardian
				NOT = {
					AND = {
						has_modifier = mem_ancestor_herald_debuff_1
						has_modifier = mem_ancestor_herald_debuff_2
						has_modifier = mem_ancestor_herald_debuff_3
						has_modifier = mem_ancestor_herald_debuff_4
						has_modifier = mem_ancestor_herald_debuff_5
						has_modifier = mem_ancestor_herald_debuff_6
					}
				}
			}
			NOT = { 
				has_fleet_flag = mem_ancestor_ftl_cooldown
			}
			any_owned_ship = {
				OR = {
					is_ship_size = mem_apostle_1
					is_ship_size = mem_apostle_2
					is_ship_size = mem_apostle_3
					is_ship_size = mem_apostle_egg
					is_ship_size = mem_apostle_child
				}
				has_hp_percentage < 0.25
				has_hp_percentage > 0
			}
		}	
	}
	
	immediate = {
		random_combatant_fleet = {
			limit = {
				exists = owner
				owner = {
					is_country_type = mem_ancestor_guardian
				}
				NOT = { 
					has_fleet_flag = mem_ancestor_ftl_cooldown
				}
				any_owned_ship = {
					OR = {
						is_ship_size = mem_apostle_1
						is_ship_size = mem_apostle_2
						is_ship_size = mem_apostle_3
						is_ship_size = mem_apostle_egg
						is_ship_size = mem_apostle_child
					}
				}
			}
			solar_system = {
				save_event_target_as = mem_ancestor_escape_loc_1
				random_system_planet = {
					limit = {
						is_star = yes
					}
					mem_effect_explosion_5_big = yes
				}
				every_fleet_in_system = {
					limit = {
						exists = owner
						NOT = {
							any_owned_ship = {
								OR = {
									is_ship_size = mem_titan
									is_ship_size = mem_grave_awakened_pc
									is_ship_size = mem_conduit_avatar
									is_ship_size = mem_artifact_ship
								}
							}
							owner = {
								is_country_type = mem_ancestor_guardian
							}
						}
					}
					owner = {
						if = {
							limit = {
								is_ai = no
								is_country_type = default
							}
							country_event = { id = mem_ancestor.53 }
						}
					}
					clear_orders = yes 
					add_modifier = {
						modifier = "mem_ancestor_pc_boss_debuff"
						days = 90
					}
				}
			}
			random_rim_system = {
				limit = {
					distance = {
						source = event_target:mem_ancestor_escape_loc_1
						max_distance = 9999
						min_distance = 250
					} 
				}
				random_system_planet = {
					limit = {
						is_star = yes
					}
					mem_effect_explosion_5_big = yes
					save_event_target_as = mem_ancestor_escape_loc_2
				}
			}
			set_location = event_target:mem_ancestor_escape_loc_2
			owner = {
				random_owned_ship = {
					limit = {
						OR = {
							is_ship_size = mem_apostle_1
							is_ship_size = mem_apostle_2
							is_ship_size = mem_apostle_3
							is_ship_size = mem_apostle_egg
							is_ship_size = mem_apostle_child
						}
					}
					repair_ship = yes
					if = {
						limit = {
							NOT = {
								has_modifier = mem_ancestor_boss_enraged
							}
						}
						add_modifier = {
							modifier = "mem_ancestor_boss_enraged"
							days = 90
						}
					}
				}
			}
			set_timed_fleet_flag = {
				flag = mem_ancestor_ftl_cooldown
				days = 1800
			}
		}
	}
}

fleet_event = {
	id = mem_ancestor.12
	hide_window = yes
	
	trigger = {
		any_combatant_fleet = {
			exists = owner
			owner = {
				is_country_type = mem_ancestor_guardian
			}
			NOT = { 
				has_fleet_flag = mem_ancestor_scout_ftl_cooldown_1
			}
			any_owned_ship = {
				is_ship_size = mem_apostle_scout
				has_ship_flag = mem_ancestor_herald_1
				has_hp_percentage < 0.5
				has_hp_percentage > 0
			}
		}	
	}
	
	immediate = {
		random_combatant_fleet = {
			limit = {
				exists = owner
				owner = {
					is_country_type = mem_ancestor_guardian
				}
				NOT = { 
					has_fleet_flag = mem_ancestor_scout_ftl_cooldown_1
				}
				any_owned_ship = {
					is_ship_size = mem_apostle_scout
					has_ship_flag = mem_ancestor_herald_1
				}
			}
			solar_system = {
				save_event_target_as = mem_ancestor_escape_loc_1_scout_1
				random_system_planet = {
					limit = {
						is_star = yes
					}
					mem_effect_explosion_5_big = yes
				}
				every_fleet_in_system = {
					limit = {
						exists = owner
						NOT = {
							any_owned_ship = {
								OR = {
									is_ship_size = mem_titan
									is_ship_size = mem_grave_awakened_pc
									is_ship_size = mem_conduit_avatar
									is_ship_size = mem_artifact_ship
								}
							}
							owner = {
								is_country_type = mem_ancestor_guardian
							}
						}
					}
					owner = {
						if = {
							limit = {
								is_ai = no
								is_country_type = default
							}
							country_event = { id = mem_ancestor.53 }
						}
					}
					clear_orders = yes 
					add_modifier = {
						modifier = "mem_ancestor_pc_herald_debuff"
						days = 90
					}
				}
			}
			random_rim_system = {
				limit = {
					distance = {
						source = event_target:mem_ancestor_escape_loc_1_scout_1
						max_distance = 9999
						min_distance = 250
					} 
				}
				random_system_planet = {
					limit = {
						is_star = yes
					}
					mem_effect_explosion_5_big = yes
					save_event_target_as = mem_ancestor_escape_loc_2_scout_1
				}
			}
			set_location = event_target:mem_ancestor_escape_loc_2_scout_1
			owner = {
				random_owned_ship = {
					limit = {
						is_ship_size = mem_apostle_scout
						has_ship_flag = mem_ancestor_herald_1
					}
					repair_ship = yes
					if = {
						limit = {
							NOT = {
								has_modifier = mem_ancestor_herald_enraged
							}
						}
						add_modifier = {
							modifier = "mem_ancestor_herald_enraged"
							days = 90
						}
					}
				}
			}
			set_timed_fleet_flag = {
				flag = mem_ancestor_scout_ftl_cooldown_1
				days = 1800
			}
		}
	}
}

fleet_event = {
	id = mem_ancestor.13
	hide_window = yes
	
	trigger = {
		any_combatant_fleet = {
			exists = owner
			owner = {
				is_country_type = mem_ancestor_guardian
			}
			NOT = { 
				has_fleet_flag = mem_ancestor_scout_ftl_cooldown_2
			}
			any_owned_ship = {
				is_ship_size = mem_apostle_scout
				has_ship_flag = mem_ancestor_herald_2
				has_hp_percentage < 0.5
				has_hp_percentage > 0
			}
		}	
	}
	
	immediate = {
		random_combatant_fleet = {
			limit = {
				exists = owner
				owner = {
					is_country_type = mem_ancestor_guardian
				}
				NOT = { 
					has_fleet_flag = mem_ancestor_scout_ftl_cooldown_2
				}
				any_owned_ship = {
					is_ship_size = mem_apostle_scout
					has_ship_flag = mem_ancestor_herald_2
				}
			}
			solar_system = {
				save_event_target_as = mem_ancestor_escape_loc_1_scout_2
				random_system_planet = {
					limit = {
						is_star = yes
					}
					mem_effect_explosion_5_big = yes
				}
				every_fleet_in_system = {
					limit = {
						exists = owner
						NOT = {
							any_owned_ship = {
								OR = {
									is_ship_size = mem_titan
									is_ship_size = mem_grave_awakened_pc
									is_ship_size = mem_conduit_avatar
									is_ship_size = mem_artifact_ship
								}
							}
							owner = {
								is_country_type = mem_ancestor_guardian
							}
						}
					}
					owner = {
						if = {
							limit = {
								is_ai = no
								is_country_type = default
							}
							country_event = { id = mem_ancestor.53 }
						}
					}
					clear_orders = yes 
					add_modifier = {
						modifier = "mem_ancestor_pc_herald_debuff"
						days = 90
					}
				}
			}
			random_rim_system = {
				limit = {
					distance = {
						source = event_target:mem_ancestor_escape_loc_1_scout_2
						max_distance = 9999
						min_distance = 250
					} 
				}
				random_system_planet = {
					limit = {
						is_star = yes
					}
					mem_effect_explosion_5_big = yes
					save_event_target_as = mem_ancestor_escape_loc_2_scout_2
				}
			}
			set_location = event_target:mem_ancestor_escape_loc_2_scout_2
			owner = {
				random_owned_ship = {
					limit = {
						is_ship_size = mem_apostle_scout
						has_ship_flag = mem_ancestor_herald_2
					}
					repair_ship = yes
					if = {
						limit = {
							NOT = {
								has_modifier = mem_ancestor_herald_enraged
							}
						}
						add_modifier = {
							modifier = "mem_ancestor_herald_enraged"
							days = 90
						}
					}
				}
			}
			set_timed_fleet_flag = {
				flag = mem_ancestor_scout_ftl_cooldown_2
				days = 1800
			}
		}
	}
}

fleet_event = {
	id = mem_ancestor.14
	hide_window = yes
	
	trigger = {
		any_combatant_fleet = {
			exists = owner
			owner = {
				is_country_type = mem_ancestor_guardian
			}
			NOT = { 
				has_fleet_flag = mem_ancestor_scout_ftl_cooldown_3
			}
			any_owned_ship = {
				is_ship_size = mem_apostle_scout
				has_ship_flag = mem_ancestor_herald_3
				has_hp_percentage < 0.5
				has_hp_percentage > 0
			}
		}	
	}
	
	immediate = {
		random_combatant_fleet = {
			limit = {
				exists = owner
				owner = {
					is_country_type = mem_ancestor_guardian
				}
				NOT = { 
					has_fleet_flag = mem_ancestor_scout_ftl_cooldown_3
				}
				any_owned_ship = {
					is_ship_size = mem_apostle_scout
					has_ship_flag = mem_ancestor_herald_3
				}
			}
			solar_system = {
				save_event_target_as = mem_ancestor_escape_loc_1_scout_3
				random_system_planet = {
					limit = {
						is_star = yes
					}
					mem_effect_explosion_5_big = yes
				}
				every_fleet_in_system = {
					limit = {
						exists = owner
						NOT = {
							any_owned_ship = {
								OR = {
									is_ship_size = mem_titan
									is_ship_size = mem_grave_awakened_pc
									is_ship_size = mem_conduit_avatar
									is_ship_size = mem_artifact_ship
								}
							}
							owner = {
								is_country_type = mem_ancestor_guardian
							}
						}
					}
					owner = {
						if = {
							limit = {
								is_ai = no
								is_country_type = default
							}
							country_event = { id = mem_ancestor.53 }
						}
					}
					clear_orders = yes 
					add_modifier = {
						modifier = "mem_ancestor_pc_herald_debuff"
						days = 90
					}
				}
			}
			random_rim_system = {
				limit = {
					distance = {
						source = event_target:mem_ancestor_escape_loc_1_scout_3
						max_distance = 9999
						min_distance = 250
					} 
				}
				random_system_planet = {
					limit = {
						is_star = yes
					}
					mem_effect_explosion_5_big = yes
					save_event_target_as = mem_ancestor_escape_loc_2_scout_3
				}
			}
			set_location = event_target:mem_ancestor_escape_loc_2_scout_3
			owner = {
				random_owned_ship = {
					limit = {
						is_ship_size = mem_apostle_scout
						has_ship_flag = mem_ancestor_herald_3
					}
					repair_ship = yes
					if = {
						limit = {
							NOT = {
								has_modifier = mem_ancestor_herald_enraged
							}
						}
						add_modifier = {
							modifier = "mem_ancestor_herald_enraged"
							days = 90
						}
					}
				}
			}
			set_timed_fleet_flag = {
				flag = mem_ancestor_scout_ftl_cooldown_3
				days = 1800
			}
		}
	}
}

fleet_event = {
	id = mem_ancestor.15
	hide_window = yes
	
	trigger = {
		any_combatant_fleet = {
			exists = owner
			owner = {
				is_country_type = mem_ancestor_guardian
			}
			NOT = { 
				has_fleet_flag = mem_ancestor_scout_ftl_cooldown_4
			}
			any_owned_ship = {
				is_ship_size = mem_apostle_scout
				has_ship_flag = mem_ancestor_herald_4
				has_hp_percentage < 0.5
				has_hp_percentage > 0
			}
		}	
	}
	
	immediate = {
		random_combatant_fleet = {
			limit = {
				exists = owner
				owner = {
					is_country_type = mem_ancestor_guardian
				}
				NOT = { 
					has_fleet_flag = mem_ancestor_scout_ftl_cooldown_4
				}
				any_owned_ship = {
					is_ship_size = mem_apostle_scout
					has_ship_flag = mem_ancestor_herald_4
				}
			}
			solar_system = {
				save_event_target_as = mem_ancestor_escape_loc_1_scout_4
				random_system_planet = {
					limit = {
						is_star = yes
					}
					mem_effect_explosion_5_big = yes
				}
				every_fleet_in_system = {
					limit = {
						exists = owner
						NOT = {
							any_owned_ship = {
								OR = {
									is_ship_size = mem_titan
									is_ship_size = mem_grave_awakened_pc
									is_ship_size = mem_conduit_avatar
									is_ship_size = mem_artifact_ship
								}
							}
							owner = {
								is_country_type = mem_ancestor_guardian
							}
						}
					}
					owner = {
						if = {
							limit = {
								is_ai = no
								is_country_type = default
							}
							country_event = { id = mem_ancestor.53 }
						}
					}
					clear_orders = yes 
					add_modifier = {
						modifier = "mem_ancestor_pc_herald_debuff"
						days = 90
					}
				}
			}
			random_rim_system = {
				limit = {
					distance = {
						source = event_target:mem_ancestor_escape_loc_1_scout_4
						max_distance = 9999
						min_distance = 250
					} 
				}
				random_system_planet = {
					limit = {
						is_star = yes
					}
					mem_effect_explosion_5_big = yes
					save_event_target_as = mem_ancestor_escape_loc_2_scout_4
				}
			}
			set_location = event_target:mem_ancestor_escape_loc_2_scout_4
			owner = {
				random_owned_ship = {
					limit = {
						is_ship_size = mem_apostle_scout
						has_ship_flag = mem_ancestor_herald_4
					}
					repair_ship = yes
					if = {
						limit = {
							NOT = {
								has_modifier = mem_ancestor_herald_enraged
							}
						}
						add_modifier = {
							modifier = "mem_ancestor_herald_enraged"
							days = 90
						}
					}
				}
			}
			set_timed_fleet_flag = {
				flag = mem_ancestor_scout_ftl_cooldown_4
				days = 1800
			}
		}
	}
}

fleet_event = {
	id = mem_ancestor.16
	hide_window = yes
	
	trigger = {
		any_combatant_fleet = {
			exists = owner
			owner = {
				is_country_type = mem_ancestor_guardian
			}
			NOT = { 
				has_fleet_flag = mem_ancestor_scout_ftl_cooldown_5
			}
			any_owned_ship = {
				is_ship_size = mem_apostle_scout
				has_ship_flag = mem_ancestor_herald_5
				has_hp_percentage < 0.5
				has_hp_percentage > 0
			}
		}	
	}
	
	immediate = {
		random_combatant_fleet = {
			limit = {
				exists = owner
				owner = {
					is_country_type = mem_ancestor_guardian
				}
				NOT = { 
					has_fleet_flag = mem_ancestor_scout_ftl_cooldown_5
				}
				any_owned_ship = {
					is_ship_size = mem_apostle_scout
					has_ship_flag = mem_ancestor_herald_5
				}
			}
			solar_system = {
				save_event_target_as = mem_ancestor_escape_loc_1_scout_5
				random_system_planet = {
					limit = {
						is_star = yes
					}
					mem_effect_explosion_5_big = yes
				}
				every_fleet_in_system = {
					limit = {
						exists = owner
						NOT = {
							any_owned_ship = {
								OR = {
									is_ship_size = mem_titan
									is_ship_size = mem_grave_awakened_pc
									is_ship_size = mem_conduit_avatar
									is_ship_size = mem_artifact_ship
								}
							}
							owner = {
								is_country_type = mem_ancestor_guardian
							}
						}
					}
					owner = {
						if = {
							limit = {
								is_ai = no
								is_country_type = default
							}
							country_event = { id = mem_ancestor.53 }
						}
					}
					clear_orders = yes 
					add_modifier = {
						modifier = "mem_ancestor_pc_herald_debuff"
						days = 90
					}
				}
			}
			random_rim_system = {
				limit = {
					distance = {
						source = event_target:mem_ancestor_escape_loc_1_scout_5
						max_distance = 9999
						min_distance = 250
					} 
				}
				random_system_planet = {
					limit = {
						is_star = yes
					}
					mem_effect_explosion_5_big = yes
					save_event_target_as = mem_ancestor_escape_loc_2_scout_5
				}
			}
			set_location = event_target:mem_ancestor_escape_loc_2_scout_5
			owner = {
				random_owned_ship = {
					limit = {
						is_ship_size = mem_apostle_scout
						has_ship_flag = mem_ancestor_herald_5
					}
					repair_ship = yes
					if = {
						limit = {
							NOT = {
								has_modifier = mem_ancestor_herald_enraged
							}
						}
						add_modifier = {
							modifier = "mem_ancestor_herald_enraged"
							days = 90
						}
					}
				}
			}
			set_timed_fleet_flag = {
				flag = mem_ancestor_scout_ftl_cooldown_5
				days = 1800
			}
		}
	}
}

fleet_event = {
	id = mem_ancestor.17
	hide_window = yes
	
	trigger = {
		any_combatant_fleet = {
			exists = owner
			owner = {
				is_country_type = mem_ancestor_guardian
			}
			NOT = { 
				has_fleet_flag = mem_ancestor_scout_ftl_cooldown_6
			}
			any_owned_ship = {
				is_ship_size = mem_apostle_scout
				has_ship_flag = mem_ancestor_herald_6
				has_hp_percentage < 0.5
				has_hp_percentage > 0
			}
		}	
	}
	
	immediate = {
		random_combatant_fleet = {
			limit = {
				exists = owner
				owner = {
					is_country_type = mem_ancestor_guardian
				}
				NOT = { 
					has_fleet_flag = mem_ancestor_scout_ftl_cooldown_6
				}
				any_owned_ship = {
					is_ship_size = mem_apostle_scout
					has_ship_flag = mem_ancestor_herald_6
				}
			}
			solar_system = {
				save_event_target_as = mem_ancestor_escape_loc_1_scout_6
				random_system_planet = {
					limit = {
						is_star = yes
					}
					mem_effect_explosion_5_big = yes
				}
				every_fleet_in_system = {
					limit = {
						exists = owner
						NOT = {
							any_owned_ship = {
								OR = {
									is_ship_size = mem_titan
									is_ship_size = mem_grave_awakened_pc
									is_ship_size = mem_conduit_avatar
									is_ship_size = mem_artifact_ship
								}
							}
							owner = {
								is_country_type = mem_ancestor_guardian
							}
						}
					}
					owner = {
						if = {
							limit = {
								is_ai = no
								is_country_type = default
							}
							country_event = { id = mem_ancestor.53 }
						}
					}
					clear_orders = yes 
					add_modifier = {
						modifier = "mem_ancestor_pc_herald_debuff"
						days = 90
					}
				}
			}
			random_rim_system = {
				limit = {
					distance = {
						source = event_target:mem_ancestor_escape_loc_1_scout_6
						max_distance = 9999
						min_distance = 250
					} 
				}
				random_system_planet = {
					limit = {
						is_star = yes
					}
					mem_effect_explosion_5_big = yes
					save_event_target_as = mem_ancestor_escape_loc_2_scout_6
				}
			}
			set_location = event_target:mem_ancestor_escape_loc_2_scout_6
			owner = {
				random_owned_ship = {
					limit = {
						is_ship_size = mem_apostle_scout
						has_ship_flag = mem_ancestor_herald_6
					}
					repair_ship = yes
					if = {
						limit = {
							NOT = {
								has_modifier = mem_ancestor_herald_enraged
							}
						}
						add_modifier = {
							modifier = "mem_ancestor_herald_enraged"
							days = 90
						}
					}
				}
			}
			set_timed_fleet_flag = {
				flag = mem_ancestor_scout_ftl_cooldown_6
				days = 1800
			}
		}
	}
}

event = {
	id = mem_ancestor.18
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = mem_ancestor_crisis_start
		NOT = {
			has_global_flag = mem_ancestor_crisis_end
		}
	}
	
	immediate = {
		random_system = {
			if = {
				limit = {
					any_ship_in_system = {
						OR = {
							is_ship_size = mem_apostle_1
							is_ship_size = mem_apostle_2
							is_ship_size = mem_apostle_3
							is_ship_size = mem_apostle_4
							is_ship_size = mem_apostle_egg
							is_ship_size = mem_apostle_child
							is_ship_size = mem_apostle_scout
						}
					}
				}
				every_fleet_in_system = {
					if = {
						limit = {
							exists = this
							NOT = {
								OWNER = {
									is_country_type = mem_ancestor_guardian
								}
							}
							
						}
						add_modifier = {
							modifier = "mem_ancestor_in_system_ship_debuff"
							days = 30
						}
					}
				}
			}
		}
	}
}

fleet_event = {
	id = mem_ancestor.19
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		any_ship = {
			is_ship_size = mem_apostle_scout
		}
	}
	
	immediate = {
		if = {
			limit = {
				has_fleet_flag = mem_ancestor_herald_1
			}
			save_event_target_as = mem_ancestor_herald_1_loc
			if = {
				limit = {
					from = {
						exists = space_owner
						space_owner = {
							AND = {
								is_ai = no
								is_country_type = default
							}
						}
					}
				}
				from = {
					space_owner = {
						if = {
							limit = {
								has_technology = "tech_sensors_4"
								NOT = {
									has_country_flag = mem_apostle_1_tracker
								}
							}
							mem_ancestor_chain_check = yes
							create_point_of_interest = {
								id = mem_ancestor_herald_poi.1
								name = "mem_ancestor_herald_1_poi"
								desc = "mem_ancestor_herald_1_poi_desc"
								event_chain = mem_lex_ancestor_chain
								location = event_target:mem_ancestor_herald_1_loc
							}
							set_country_flag = mem_apostle_1_tracker
							country_event = { id = mem_ancestor.52 days = 10 }
						}	
					}
				}
			}
		}
		if = {
			limit = {
				has_fleet_flag = mem_ancestor_herald_2
			}
			save_event_target_as = mem_ancestor_herald_2_loc
			if = {
				limit = {
					from = {
						exists = space_owner
						space_owner = {
							AND = {
								is_ai = no
								is_country_type = default
							}
						}
					}
				}
				from = {
					space_owner = {
						if = {
							limit = {
								has_technology = "tech_sensors_4"
								NOT = {
									has_country_flag = mem_apostle_2_tracker
								}
							}
							mem_ancestor_chain_check = yes
							create_point_of_interest = {
								id = mem_ancestor_herald_poi.2
								name = "mem_ancestor_herald_2_poi"
								desc = "mem_ancestor_herald_2_poi_desc"
								event_chain = mem_lex_ancestor_chain
								location = event_target:mem_ancestor_herald_2_loc
							}
							set_country_flag = mem_apostle_2_tracker
							country_event = { id = mem_ancestor.52 days = 10 }
						}	
					}
				}
			}
		}
		if = {
			limit = {
				has_fleet_flag = mem_ancestor_herald_3
			}
			save_event_target_as = mem_ancestor_herald_3_loc
			if = {
				limit = {
					from = {
						exists = space_owner
						space_owner = {
							AND = {
								is_ai = no
								is_country_type = default
							}
						}
					}
				}
				from = {
					space_owner = {
						if = {
							limit = {
								has_technology = "tech_sensors_4"
								NOT = {
									has_country_flag = mem_apostle_3_tracker
								}
							}
							mem_ancestor_chain_check = yes
							create_point_of_interest = {
								id = mem_ancestor_herald_poi.3
								name = "mem_ancestor_herald_3_poi"
								desc = "mem_ancestor_herald_3_poi_desc"
								event_chain = mem_lex_ancestor_chain
								location = event_target:mem_ancestor_herald_3_loc
							}
							set_country_flag = mem_apostle_3_tracker
							country_event = { id = mem_ancestor.52 days = 10 }
						}	
					}
				}
			}
		}
		if = {
			limit = {
				has_fleet_flag = mem_ancestor_herald_4
			}
			save_event_target_as = mem_ancestor_herald_4_loc
			if = {
				limit = {
					from = {
						exists = space_owner
						space_owner = {
							AND = {
								is_ai = no
								is_country_type = default
							}
						}
					}
				}
				from = {
					space_owner = {
						if = {
							limit = {
								has_technology = "tech_sensors_4"
								NOT = {
									has_country_flag = mem_apostle_4_tracker
								}
							}
							mem_ancestor_chain_check = yes
							create_point_of_interest = {
								id = mem_ancestor_herald_poi.4
								name = "mem_ancestor_herald_4_poi"
								desc = "mem_ancestor_herald_4_poi_desc"
								event_chain = mem_lex_ancestor_chain
								location = event_target:mem_ancestor_herald_4_loc
							}
							set_country_flag = mem_apostle_4_tracker
							country_event = { id = mem_ancestor.52 days = 10 }
						}	
					}
				}
			}
		}
		if = {
			limit = {
				has_fleet_flag = mem_ancestor_herald_5
			}
			save_event_target_as = mem_ancestor_herald_5_loc
			if = {
				limit = {
					from = {
						exists = space_owner
						space_owner = {
							AND = {
								is_ai = no
								is_country_type = default
							}
						}
					}
				}
				from = {
					space_owner = {
						if = {
							limit = {
								has_technology = "tech_sensors_4"
								NOT = {
									has_country_flag = mem_apostle_5_tracker
								}
							}
							mem_ancestor_chain_check = yes
							create_point_of_interest = {
								id = mem_ancestor_herald_poi.5
								name = "mem_ancestor_herald_5_poi"
								desc = "mem_ancestor_herald_5_poi_desc"
								event_chain = mem_lex_ancestor_chain
								location = event_target:mem_ancestor_herald_5_loc
							}
							set_country_flag = mem_apostle_5_tracker
							country_event = { id = mem_ancestor.52 days = 10 }
						}	
					}
				}
			}
		}
		if = {
			limit = {
				has_fleet_flag = mem_ancestor_herald_6
			}
			save_event_target_as = mem_ancestor_herald_6_loc
			if = {
				limit = {
					from = {
						exists = space_owner
						space_owner = {
							AND = {
								is_ai = no
								is_country_type = default
							}
						}
					}
				}
				from = {
					space_owner = {
						if = {
							limit = {
								has_technology = "tech_sensors_4"
								NOT = {
									has_country_flag = mem_apostle_6_tracker
								}
							}
							mem_ancestor_chain_check = yes
							create_point_of_interest = {
								id = mem_ancestor_herald_poi.1
								name = "mem_ancestor_herald_1_poi"
								desc = "mem_ancestor_herald_1_poi_desc"
								event_chain = mem_lex_ancestor_chain
								location = event_target:mem_ancestor_herald_6_loc
							}
							set_country_flag = mem_apostle_6_tracker
							country_event = { id = mem_ancestor.52 days = 10 }
						}	
					}
				}
			}
		}
	}
}

#Seal bursts

ship_event = {
	id = mem_ancestor.20
	hide_window = yes
	
	is_triggered_only = yes

	trigger = {
		is_ship_size = mem_apostle_seal
	}

	immediate = {
		from = {
			owner = {
				if = {
					limit = {
						NOT = {
							has_country_flag = mem_ancestor_seal_destroyer
						}
					}
				}
				set_country_flag = mem_ancestor_seal_destroyer
			}
		}
		every_country = {
			limit = {
				is_ai = no
				is_country_type = default
			}
			country_event = { id = mem_ancestor.41 days = 10 }
		}
		mem_ancestor_seal_change_1 = yes
		mem_ancestor_seal_change_2 = yes
		mem_ancestor_seal_change_3 = yes
		mem_ancestor_seal_change_4 = yes
		mem_ancestor_seal_change_5 = yes
		mem_ancestor_seal_change_6 = yes
		
	}
}

#Seal turns into miniature black hole

planet_event = {
	id = mem_ancestor.21
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_system = {
			limit = {
				has_star_flag = mem_prison_system
			}
			save_event_target_as = mem_prison_system
			every_system_ambient_object = {
				if = {
					limit = {
						has_ambient_object_flag = mem_ancestor_seal_1_burst
					}
					this = {
						mem_effect_explosion_2 = yes
					}
					event_target:mem_prison_system = {
						every_system_planet = {
							limit = { has_planet_flag = mem_ancestor_prison_planet_1 }
							orbital_deposit_tile = {
								clear_deposits = yes
							}
							orbital_deposit_tile = {
								add_deposit = d_mem_seal_exhausted
							}
							change_pc = pc_black_hole
							mem_ancestor_clear_station = yes	
						}
					}
					destroy_ambient_object = this
					set_global_flag = mem_ancestor_seal_1_global
					mem_ancestor_seal_chain = yes
					break = yes
				}
				if = {
					limit = {
						has_ambient_object_flag = mem_ancestor_seal_2_burst
					}
					this = {
						mem_effect_explosion_2 = yes
					}
					event_target:mem_prison_system = {
						every_system_planet = {
							limit = { has_planet_flag = mem_ancestor_prison_planet_2 }
							orbital_deposit_tile = {
								clear_deposits = yes
							}
							orbital_deposit_tile = {
								add_deposit = d_mem_seal_exhausted
							}
							change_pc = pc_black_hole
							mem_ancestor_clear_station = yes
						}
					}
					destroy_ambient_object = this
					set_global_flag = mem_ancestor_seal_2_global
					mem_ancestor_seal_chain = yes
					break = yes
				}
				if = {
					limit = {
						has_ambient_object_flag = mem_ancestor_seal_3_burst
					}
					this = {
						mem_effect_explosion_2 = yes
					}
					event_target:mem_prison_system = {
						every_system_planet = {
							limit = { has_planet_flag = mem_ancestor_prison_planet_3 }
							orbital_deposit_tile = {
								clear_deposits = yes
							}
							orbital_deposit_tile = {
								add_deposit = d_mem_seal_exhausted
							}
							change_pc = pc_black_hole
							mem_ancestor_clear_station = yes
						}
					}
					destroy_ambient_object = this
					set_global_flag = mem_ancestor_seal_3_global
					mem_ancestor_seal_chain = yes
					break = yes
				}
				if = {
					limit = {
						has_ambient_object_flag = mem_ancestor_seal_4_burst
					}
					this = {
						mem_effect_explosion_2 = yes
					}
					event_target:mem_prison_system = {
						every_system_planet = {
							limit = { has_planet_flag = mem_ancestor_prison_planet_4 }
							orbital_deposit_tile = {
								clear_deposits = yes
							}
							orbital_deposit_tile = {
								add_deposit = d_mem_seal_exhausted
							}
							change_pc = pc_black_hole
							mem_ancestor_clear_station = yes
						}
					}
					destroy_ambient_object = this
					set_global_flag = mem_ancestor_seal_4_global
					mem_ancestor_seal_chain = yes
					break = yes
				}
				if = {
					limit = {
						has_ambient_object_flag = mem_ancestor_seal_5_burst
					}
					this = {
						mem_effect_explosion_2 = yes
					}
					event_target:mem_prison_system = {
						every_system_planet = {
							limit = { has_planet_flag = mem_ancestor_prison_planet_5 }
							orbital_deposit_tile = {
								clear_deposits = yes
							}
							orbital_deposit_tile = {
								add_deposit = d_mem_seal_exhausted
							}
							change_pc = pc_black_hole
							mem_ancestor_clear_station = yes
						}
					}
					destroy_ambient_object = this
					set_global_flag = mem_ancestor_seal_5_global
					mem_ancestor_seal_chain = yes
					break = yes
				}
				if = {
					limit = {
						has_ambient_object_flag = mem_ancestor_seal_6_burst
					}
					this = {
						mem_effect_explosion_2 = yes
					}
					event_target:mem_prison_system = {
						every_system_planet = {
							limit = { has_planet_flag = mem_ancestor_prison_planet_6 }
							orbital_deposit_tile = {
								clear_deposits = yes
							}
							orbital_deposit_tile = {
								add_deposit = d_mem_seal_exhausted
							}
							change_pc = pc_black_hole
							mem_ancestor_clear_station = yes
						}
					}
					destroy_ambient_object = this
					set_global_flag = mem_ancestor_seal_6_global
					mem_ancestor_seal_chain = yes
					break = yes
				}
			}
		}
	}
}

# Tesseract init

country_event = {
	id = mem_ancestor.22
	hide_window = yes
	fire_only_once = yes
	
	trigger = {
		AND = {
			has_global_flag = mem_ancestor_seal_1_global
			has_global_flag = mem_ancestor_seal_2_global
			has_global_flag = mem_ancestor_seal_3_global
			has_global_flag = mem_ancestor_seal_4_global
			has_global_flag = mem_ancestor_seal_5_global
			has_global_flag = mem_ancestor_seal_6_global
		}
	}

	immediate = {
		random_system = {
			limit = {
				has_star_flag = mem_prison_system
			}
			save_event_target_as = mem_prison_system_local
			every_system_ambient_object = { 
				limit = {
					has_ambient_object_flag = mem_ancestor_prison_ambient
				}
				this = {
				 save_event_target_as = mem_ancestor_prison_failure_1
				}
				create_ambient_object = {
					type = "mem_prison_weakened_1_object"
				}
				last_created_ambient_object = {
					set_location = event_target:mem_ancestor_prison_failure_1
					set_ambient_object_flag = mem_ancestor_prison_weakened_1
				}
				create_ambient_object = {
					type = mem_effect_explosion_2_object
					duration = 10
					
					use_3d_location = yes
					
					entity_offset = { min = 0 max = 0 }
					entity_offset_angle = { min = 0 max = 0 }
					entity_offset_height = { min = 0 max = 0 }
					
					entity_scale_to_size = yes
					scale = 100
				}
				last_created_ambient_object = {
					set_location = event_target:mem_ancestor_prison_failure_1
				}
				destroy_ambient_object = this
			}
			every_system_planet = {
				limit = {
					has_planet_flag = mem_ancestor_prison_star 
				}
				orbital_deposit_tile = {
					add_deposit = d_mem_prison_1
				}
			}
		}
		every_country = {
			limit = {
				is_ai = no
				is_country_type = default
			}
			country_event = { id = mem_ancestor.42 days = 10 }
		}
		country_event = { id = mem_ancestor.23 days = 1800 }
	}
}

# Tesseract Stage 2

country_event = {
	id = mem_ancestor.23
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_system = {
			limit = {
				has_star_flag = mem_prison_system
			}
			every_system_ambient_object = { 
				limit = {
					has_ambient_object_flag = mem_ancestor_prison_weakened_1
				}
				this = {
				 save_event_target_as = mem_ancestor_prison_failure_2
				}
				create_ambient_object = {
					type = "mem_prison_weakened_2_object"
				}
				last_created_ambient_object = {
					set_location = event_target:mem_ancestor_prison_failure_2
					set_ambient_object_flag = mem_ancestor_prison_weakened_2
				}
				create_ambient_object = {
					type = mem_effect_explosion_2_object
					duration = 10
					
					use_3d_location = yes
					
					entity_offset = { min = 0 max = 0 }
					entity_offset_angle = { min = 0 max = 0 }
					entity_offset_height = { min = 0 max = 0 }
					
					entity_scale_to_size = yes
					scale = 100
				}
				last_created_ambient_object = {
					set_location = event_target:mem_ancestor_prison_failure_2
				}
				destroy_ambient_object = this
			}
			every_system_planet = {
				limit = {
					has_planet_flag = mem_ancestor_prison_star 
				}
				orbital_deposit_tile = {
					clear_deposits = yes
				}
				orbital_deposit_tile = {
					add_deposit = d_mem_prison_2
				}
				mem_ancestor_clear_station = yes
			}
		}
		country_event = { id = mem_ancestor.24 days = 1800 }
	}
}

# Tesseract Stage 3

country_event = {
	id = mem_ancestor.24
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_system = {
			limit = {
				has_star_flag = mem_prison_system
			}
			every_system_ambient_object = { 
				limit = {
					has_ambient_object_flag = mem_ancestor_prison_weakened_2
				}
				this = {
				 save_event_target_as = mem_ancestor_prison_failure_3
				}
				create_ambient_object = {
					type = "mem_prison_damaged_object"
				}
				last_created_ambient_object = {
					set_location = event_target:mem_ancestor_prison_failure_3
					set_ambient_object_flag = mem_ancestor_prison_weakened_3
				}
				create_ambient_object = {
					type = mem_effect_explosion_2_object
					duration = 10
					
					use_3d_location = yes
					
					entity_offset = { min = 0 max = 0 }
					entity_offset_angle = { min = 0 max = 0 }
					entity_offset_height = { min = 0 max = 0 }
					
					entity_scale_to_size = yes
					scale = 100
				}
				last_created_ambient_object = {
					set_location = event_target:mem_ancestor_prison_failure_3
				}
				destroy_ambient_object = this
			}
			every_system_planet = {
				limit = {
					has_planet_flag = mem_ancestor_prison_star 
				}
				orbital_deposit_tile = {
					clear_deposits = yes
				}
				orbital_deposit_tile = {
					add_deposit = d_mem_prison_3
				}
				mem_ancestor_clear_station = yes
			}
		}
		country_event = { id = mem_ancestor.25 days = 1800 }
	}
}

# Massive black hole appears.

country_event = {
	id = mem_ancestor.25
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_system = {
			limit = {
				has_star_flag = mem_prison_system
			}
			save_event_target_as = mem_prison_system_local
			every_system_ambient_object = { 
				limit = {
					has_ambient_object_flag = mem_ancestor_prison_weakened_3
				}
				destroy_ambient_object = this
			}
			every_system_planet = {
				limit = {
					has_planet_flag = mem_ancestor_prison_star
				}
				change_pc = pc_black_hole
				change_planet_size = 100
				orbital_deposit_tile = {
					clear_deposits = yes
				}
				orbital_deposit_tile = {
					add_deposit = d_mem_prison_exhausted
				}
				mem_effect_explosion_6_big = yes
				mem_ancestor_clear_station = yes
			}
			every_system_planet = {
				limit = {
					OR = {
						has_planet_flag = mem_ancestor_prison_planet_1
						has_planet_flag = mem_ancestor_prison_planet_2
						has_planet_flag = mem_ancestor_prison_planet_3
						has_planet_flag = mem_ancestor_prison_planet_4
						has_planet_flag = mem_ancestor_prison_planet_5
						has_planet_flag = mem_ancestor_prison_planet_6
					}
				}
				mem_ancestor_clear_station = yes
				remove_planet = yes 
			}
			every_fleet_in_system = {
				destroy_fleet = this
			}
		}
		every_country = {
			limit = {
				is_ai = no
				is_country_type = default
			}
			country_event = { id = mem_ancestor.43 days = 10 }
		}
		country_event = { id = mem_ancestor.27 days = 360 }
		set_timed_global_flag = {
			flag = mem_ancestor_black_hole
			days = 360
		}
	}
}

#Super Massive Black Hole applies debuff to fleet for 5 years

event = {
	id = mem_ancestor.26
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = mem_ancestor_black_hole
	}
	
	immediate = {
		random_system = {
			limit = {
				has_star_flag = mem_prison_system
			}
			every_fleet_in_system = {
				if = {
					limit = {
						exists = this
						NOT = {
							OWNER = {
								is_country_type = mem_ancestor_guardian
							}
						}
					}
					add_modifier = {
						modifier = "mem_ancestor_black_hole_debuff"
						days = 30
					}
				}
			}
		}
	}
}

country_event = {
	id = mem_ancestor.27
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_global_flag = mem_ancestor_crisis_start
		}
	}
	
	immediate =  {
		mem_ancestor_target = yes
		random_system = {
			limit = {
				has_star_flag = mem_prison_system
			}
			random_system_planet = {
				limit = {
					has_planet_flag = mem_ancestor_prison_star
				}
				create_country = {
					name = "Chosen of Thesan"
					type = mem_ancestor_guardian
					flag = {
						icon = {
							category = "ornate"
							file = "flag_ornate_23.dds"
						}
						background= {
							category = "backgrounds"
							file = "00_solid.dds"
						}
						 colors={
							"pink"
							"pink"
							"null"
							"null"
						}
					}
				}
				last_created_country = {
					if = {
						limit = {
							NOT = {
								has_modifier = mem_ancestor_power
							}
						}
						add_modifier = {
							modifier = mem_ancestor_power
							days = -1
						}
						add_modifier = {
							modifier = mem_ancestor_escape_power
							days = 90
						}
					}
					save_global_event_target_as = mem_ancestor_country
					set_country_flag = mem_ancestor_country
					set_graphical_culture = fallen_empire_01
					guardian_difficulty = yes
				}
				mem_effect_explosion_6_big = yes
				mem_ancestor_vessel_init = yes
				mem_ancestor_herald_1 = yes
				mem_ancestor_herald_2 = yes
				mem_ancestor_herald_3 = yes
				mem_ancestor_herald_4 = yes
				mem_ancestor_herald_5 = yes
				mem_ancestor_herald_6 = yes
			}
		}
		every_country = {
			if = {
				limit = {
					is_ai = no
					is_country_type = default
				}
				country_event = { id = mem_ancestor.44 }
				establish_communications_no_message = event_target:mem_ancestor_country
			}
			if = {
				limit = {
					OR = {
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
					}
				}
				country_event = { id = mem_ancestor.28 days = 30 }
			}
		}
		set_global_flag = mem_ancestor_crisis_start
	}
}

#Fallen and Awakened Empires declare war on the seal destroyer.

country_event = {
	id = mem_ancestor.28
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				is_country_type = fallen_empire
			}
			country_event = { id = mem_ancestor.29 }
		}
		if = {
			limit = {
				any_country = {
					has_country_flag = mem_ancestor_seal_destroyer
				}
			}
			this = {
				save_event_target_as = mem_ancestor_fallen
			}
			random_country = {
				limit = {
					OR = {
						has_country_flag = mem_ancestor_seal_destroyer
						has_country_flag = mem_titan_slayer
						has_country_flag = mem_grave_slayer
						has_country_flag = mem_conduit_slayer
					}
				}
				save_event_target_as = mem_ancestor_sealing_war_target
			}
			if = {
				limit = {
					NOT = {
						has_communications = event_target:mem_ancestor_sealing_war_target
					}
				}
				establish_communications_no_message = event_target:mem_ancestor_sealing_war_target
			}
			declare_war = {
				who = event_target:mem_ancestor_sealing_war_target
				major_war = yes
				name = "War Of Sealing"
			}
			add_war_demand = {
				type = "total_defeat"
				parameter:country = event_target:mem_ancestor_sealing_war_target
				warscore_cost = 75
				target = this
				enemy = event_target:mem_ancestor_sealing_war_target
			}
			event_target:mem_ancestor_sealing_war_target = {
				country_event = { id = mem_ancestor.49 }
			}
		}
	}
}

#Forced awakening at start of crisis

country_event = {
	id = mem_ancestor.29
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		set_country_flag = sleepers_awake_first_sleeper
		set_country_type = awakened_fallen_empire
		change_government = {
			civics = {
				civic = civic_revanchist_fervor
				civic = civic_ancient_caches_of_technology
			}
		}

		add_minerals = 20000
		add_energy = 10000
		add_influence = 1000
		
		while = {
			count = 7
			country_event = { id = fallen_empires.13 }
		}

		every_country = {
			limit = {
				OR = {
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}		
				NOT = { has_communications = root }
			}
			establish_communications_no_message = root	
			root = { save_event_target_as = contact_empire }
			country_event = { id = action.1 }				
		}
	}
}

#Seal Chain Reaction

country_event = {
	id = mem_ancestor.30
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			AND = {
				has_global_flag = mem_ancestor_seal_1_global
				has_global_flag = mem_ancestor_seal_2_global
				has_global_flag = mem_ancestor_seal_3_global
				has_global_flag = mem_ancestor_seal_4_global
				has_global_flag = mem_ancestor_seal_5_global
				has_global_flag = mem_ancestor_seal_6_global
			}
		}
	}

	immediate = {
		every_country = { 
			if = {
				limit = {
					has_country_flag = mem_prison_country
				}
				every_owned_ship = {
				mem_ancestor_seal_change_1 = yes
				mem_ancestor_seal_change_2 = yes
				mem_ancestor_seal_change_3 = yes
				mem_ancestor_seal_change_4 = yes
				mem_ancestor_seal_change_5 = yes
				mem_ancestor_seal_change_6 = yes
				}
			}
		}		
	}
}

#Keep AI out of the Vanth System

fleet_event = {
	id = mem_ancestor.31
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		owner = {
			NOT = {
				is_country_type = mem_ancestor_guardian
			}
			is_ai = yes
		}
		FROM = {
			has_star_flag = mem_prison_system
			any_ship = { 
				AND = {
					is_ship_size = mem_apostle_seal
					owner = { is_country_type = mem_prison_passive }
				}
			}
		}
	}
	
	immediate = {
		FROM = {
			save_event_target_as = mem_ancestor_bounce_1_loc
		}
		random_system = {
			limit = {
				distance = {
					source = event_target:mem_ancestor_bounce_1_loc
					max_distance = 9999
					min_distance = 100
				} 
			}
			random_system_planet = {
				limit = {
					is_star = yes
				}
				save_event_target_as = mem_ancestor_bounce_2_loc
			}
		}
		set_location = event_target:mem_ancestor_bounce_2_loc
		clear_orders = yes 
	}		
}

# Entering system

ship_event = {
	id = mem_ancestor.40
	title = "mem_ancestor.40"
	desc = "mem_ancestor.40.desc"
	picture = GFX_evt_city_ruins
	show_sound = event_mystic_reveal_light
	location = FROM
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			OR = {
				has_global_flag = mem_ancestor_seal_1_global
				has_global_flag = mem_ancestor_seal_2_global
				has_global_flag = mem_ancestor_seal_3_global
				has_global_flag = mem_ancestor_seal_4_global
				has_global_flag = mem_ancestor_seal_5_global
				has_global_flag = mem_ancestor_seal_6_global
				has_global_flag = mem_ancestor_crisis_start
			}
		}
		owner = {
			NOT = {
				has_country_flag = mem_ancestor_seal_destroyer
				has_country_flag = encountered_mem_prison 
			}
			is_ai = no
		}
		FROM = {
			has_star_flag = mem_prison_system
			any_ship = { 
				AND = {
					is_ship_size = mem_apostle_seal
					owner = { is_country_type = mem_prison_passive }
				}
			}
		}
	}
	
	immediate = {
		from = {
			save_event_target_as = mem_prison_loc
		}
		owner = {
			establish_communications_no_message = event_target:mem_prison_country_1
			establish_communications_no_message = event_target:mem_prison_country_2
			establish_communications_no_message = event_target:mem_prison_country_3
			establish_communications_no_message = event_target:mem_prison_country_4
			establish_communications_no_message = event_target:mem_prison_country_5
			establish_communications_no_message = event_target:mem_prison_country_6
			set_country_flag = encountered_mem_prison
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "mem_lex_prison_chain" 
				}
				end_event_chain = "mem_lex_prison_chain"
			}
		}
	}	
	
	option = {
		name =  CURIOUS
	}
}

# Notification - seal busted

country_event = {
	id = mem_ancestor.41
	title = "mem_ancestor.41"
	desc = "mem_ancestor.41.desc"
	picture = GFX_evt_star_pulsar
	
	is_triggered_only = yes
	
	trigger = {
		has_country_flag = mem_ancestor_seal_destroyer
		NOT = {
			has_country_flag = mem_ancestor_seal_notification
		}
	}
	
	immediate = {
		set_country_flag = mem_ancestor_seal_notification
	}
	
	option = {
		name = "mem_ancestor.41.a"
	}
}

# Notification - tesseract breaks down

country_event = {
	id = mem_ancestor.42
	title = "mem_ancestor.42"
	desc = "mem_ancestor.42.desc"
	picture = GFX_evt_physics_research
	location = event_target:mem_prison_system_local
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = mem_ancestor_prison_notification
		}
	}
	
	immediate = {
		set_country_flag = mem_ancestor_prison_notification
	}
	
	option = {
		name = "mem_ancestor.42.a"
	}
}

# Notification - tesseract explodes

country_event = {
	id = mem_ancestor.43
	title = "mem_ancestor.43"
	desc = "mem_ancestor.43.desc"
	picture = GFX_evt_black_hole
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = mem_ancestor_explosion_notification
		}
	}
	
	immediate = {
		set_country_flag = mem_ancestor_explosion_notification
	}
	
	option = {
		name = "mem_ancestor.43.a"
	}
}

# Notification - Leviathan appears

country_event = {
	id = mem_ancestor.44
	title = "mem_ancestor.44"
	desc = "mem_ancestor.44.desc"
	picture = GFX_evt_wormhole
	show_sound = event_red_alert
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = mem_ancestor_crisis_notification
		}
	}
	
	immediate = {
		set_country_flag = mem_ancestor_crisis_notification
	}
	
	option = {
		name = "mem_ancestor.44.a"
		begin_event_chain = {
			event_chain = "mem_lex_ancestor_chain"
			target = ROOT
		}
	}
}

# Notification - Leviathan evolves

country_event = {
	id = mem_ancestor.45
	title = "mem_ancestor.45"
	desc = "mem_ancestor.45.desc"
	picture = GFX_evt_unspeakable_horror
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = mem_ancestor_boss_evolution_notification
		}
	}
	
	immediate = {
		set_country_flag = mem_ancestor_boss_evolution_notification
	}
	
	option = {
		name = "mem_ancestor.45.a"
	}
}

# Notification - Leviathan gives birth

country_event = {
	id = mem_ancestor.46
	title = "mem_ancestor.46"
	desc = "mem_ancestor.46.desc"
	picture = GFX_evt_psionics
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = mem_ancestor_boss_birth_notification
		}
	}
	
	immediate = {
		set_country_flag = mem_ancestor_boss_birth_notification
	}
	
	option = {
		name = "mem_ancestor.46.a"
	}
}

country_event = {
	id = mem_ancestor.47
	title = "mem_ancestor.47"
	desc = "mem_ancestor.47.desc"
	picture = GFX_evt_nuclear_explosion
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = mem_ancestor_genocide_notification
		}
	}
	
	immediate = {
		set_country_flag = mem_ancestor_genocide_notification
	}
	
	option = {
		name = "mem_ancestor.47.a"
	}
}

country_event = {
	id = mem_ancestor.48
	title = "mem_ancestor.48"
	desc = "mem_ancestor.48.desc"
	picture = GFX_evt_nuclear_explosion
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = mem_ancestor_world_bombed
		}
	}
	
	immediate = {
		set_country_flag = mem_ancestor_world_bombed
	}
	
	option = {
		name = "mem_ancestor.48.a"
	}
}

country_event = {
	id = mem_ancestor.49
	title = "mem_ancestor.49"
	desc = "mem_ancestor.49.desc"
	picture = GFX_evt_nuclear_explosion
	
	is_triggered_only = yes
	
	diplomatic = yes
	
	trigger = {
		NOT = {
			has_global_flag = mem_ancestor_sealing_war
		}
	}

	picture_event_data = {
		portrait = event_target:mem_ancestor_fallen
		planet_background = event_target:mem_ancestor_fallen
		graphical_culture = event_target:mem_ancestor_fallen
		city_level = event_target:mem_ancestor_fallen
		room = event_target:mem_ancestor_fallen
	}

	immediate = {
		set_global_flag = mem_ancestor_sealing_war
	}
	
	option = {
		name = "mem_ancestor.49.a"
		response_text = "mem_ancestor.49.a.response"
	}
}

# Crisis ends with the death of the Leviathan.

country_event = {
	id = mem_ancestor.50
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = mem_ancestor_guardian
		has_country_flag = mem_ancestor_country
		FROMFROM = { 
			OR = {
				is_ship_size = mem_apostle_1
				is_ship_size = mem_apostle_2
				is_ship_size = mem_apostle_3
				is_ship_size = mem_apostle_egg
				is_ship_size = mem_apostle_child
			}	
		}
	}
	
	immediate = {
		if = {
			limit = {
				has_global_flag = mem_ancestor_crisis_start
				NOT = {
					has_global_flag = mem_ancestor_crisis_end
				}
			}
			remove_global_flag = mem_ancestor_crisis_start
			set_global_flag = mem_ancestor_crisis_end
		}
		FROMFROM = {
			create_ambient_object = {
				type = mem_effect_explosion_8_object
				location = THIS
				duration = 10
				
				use_3d_location = yes
				
				entity_offset = { min = 0 max = 0 }
				entity_offset_angle = { min = 0 max = 0 }
				entity_offset_height = { min = 0 max = 0 }
				
				entity_scale_to_size = yes
				scale = 100
			}
		}
		FROM = {
			country_event = { id = mem_ancestor.51 }
			set_country_flag = mem_ancestor_slayer
		}
		every_planet = {
			if ={
				limit = {
					has_planet_flag = mem_ancestor_world
				}
				every_tile = {
					limit = { has_blocker = "tb_mem_nature" }
					remove_blocker = yes
				}
			}
		}
		every_country = {
			if = {
				limit = { 
					has_modifier = mem_ancestor_weakness
				}
				remove_modifier = "mem_ancestor_weakness"
			}
			if = {
				limit = {
					has_special_project = MEM_ANCESTOR_WEAKNESS_PROJECT
				}
				abort_special_project = {
					type = "MEM_ANCESTOR_WEAKNESS_PROJECT"
					location = capital_scope
				}
			}
			if = {
				limit = {
					has_event_chain = "mem_lex_ancestor_chain" 
				}
				end_event_chain = "mem_lex_ancestor_chain"
			}
		}
		add_threat = {
			who = FROM
			amount = 100
		}
		destroy_country = yes
	}
}

#Crisis end notification.

country_event = {
	id = mem_ancestor.51
	title = "mem_ancestor.51"
	desc = "mem_ancestor.51.desc"
	picture = GFX_evt_small_space_battle
	
	is_triggered_only = yes
	
	option = {
		name = "mem_ancestor.51.a"
	}
}

country_event = {
	id = mem_ancestor.52
	title = "mem_ancestor.52"
	desc = "mem_ancestor.52.desc"
	picture = GFX_evt_satellite_in_orbit
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = mem_ancestor_herald_tracker_notify
		}
	}
	
	immediate = {
		set_country_flag = mem_ancestor_herald_tracker_notify
	}
	
	option = {
		name = "EXCELLENT"
	}
}

country_event = {
	id = mem_ancestor.53
	title = "mem_ancestor.53"
	desc = "mem_ancestor.53.desc"
	picture = GFX_evt_unknown_ships
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = mem_ancestor_special_ability_notify
		}
	}
	
	immediate = {
		set_country_flag = mem_ancestor_special_ability_notify
	}
	
	option = {
		name = "CURSES"
	}
}

#Crisis research

country_event = {
	id = mem_ancestor.60
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_country_type = mem_ancestor_guardian
		
		from = {
			NOT = {
				has_country_flag = mem_ancestor_weakness_check
			}
			is_country_type = default
			is_ai = no
	
			AND = {
				OR = {
					has_technology = "tech_ship_armor_5"
					has_technology = "tech_dragon_armor"
				}
				OR = {
					has_technology = "tech_shields_5"
					has_technology = "tech_enigmatic_deflector"
				}		
				OR = {
					has_technology = "tech_zero_point_power"
					has_technology = "tech_enigmatic_power_core"
				}
				OR = {
					has_technology = "tech_energy_lance_2"
					has_technology = "tech_arc_emitter_2"
					has_technology = "tech_mass_accelerator_2"
				}
			}
		}
	}

	immediate = {
		if = {
			limit = {
				check_variable = {
					which = "mem_ancestor_kill_counter"
					value < 1
				}
			}
			set_variable = {
				which = "mem_ancestor_kill_counter"
				value = 1
			}
			else = {
				change_variable = {
					which = "mem_ancestor_kill_counter"
					value = 1
				}
				if = {
					limit = {
						check_variable = {
							which = "mem_ancestor_kill_counter"
							value = 100
						}
					}
					from = {
						set_country_flag = mem_ancestor_weakness_check
						country_event = { id = mem_ancestor.61 days = 30 }
					}
				}
			}
		}
	}
}

country_event = {
	id = mem_ancestor.61
	title = "mem_ancestor.61"
	desc = "mem_ancestor.61.desc"
	picture = GFX_evt_exploding_ship
	is_triggered_only = yes

	trigger = {
		NOT = {
			any_country = {
				has_country_flag = mem_ancestor_slayer
			}
			has_country_flag = mem_ancestor_weakness_researched 
		}
	}

	option = {
		name = mem_ancestor.61.a
		allow = {
			hidden_trigger = {
				NOT = { has_modifier = mem_ancestor_weakness }
			}
		}
		hidden_effect = { set_country_flag = mem_ancestor_weakness_researched }
		capital_scope = { save_event_target_as = mem_pc_home }
		enable_special_project = {
			name = "MEM_ANCESTOR_WEAKNESS_PROJECT"
			location = event_target:mem_pc_home
			owner = ROOT
		}
	}	
	option = {
		name = mem_ancestor.61.b
		add_influence = 100
	}
}

country_event = {
	id = mem_ancestor.62
	title = "mem_ancestor.62"
	desc = "mem_ancestor.62.desc"
	picture = GFX_evt_physics_research
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_modifier = mem_ancestor_weakness
		}
	}

	option = {
		name = mem_ancestor.62.a
		add_modifier = {
			modifier = mem_ancestor_weakness
			days = -1
		}
	}
}

#Crisis gets debuffed with death of a Herald.

country_event = {
	id = mem_ancestor.70
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes

	trigger = {
		is_country_type = mem_ancestor_guardian
		has_country_flag = mem_ancestor_country
		FROMFROM = {
			has_ship_flag = mem_ancestor_herald_1
			is_ship_size = mem_apostle_scout
		}
	}

	immediate = {
		FROMFROM = {
			mem_effect_explosion_8 = yes
		}
		remove_point_of_interest = mem_ancestor_herald_poi.1
		every_country = {
			limit = {
				has_event_chain = "mem_lex_ancestor_chain" 
			}
			add_event_chain_counter = { 
				event_chain = "mem_lex_ancestor_chain" 
				counter = "mem_ancestor_herald_counter" 
				amount = 1 
			}
		}
		random_country = {
			limit = { 
				is_country_type = mem_ancestor_guardian
			}
			add_modifier = {
				modifier = "mem_ancestor_herald_debuff_1"
				days = -1
			}
		}
	}
}

country_event = {
	id = mem_ancestor.71
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes

	trigger = {
		is_country_type = mem_ancestor_guardian
		has_country_flag = mem_ancestor_country
		FROMFROM = {
			has_ship_flag = mem_ancestor_herald_2
			is_ship_size = mem_apostle_scout
		}
	}

	immediate = {
		FROMFROM = {
			mem_effect_explosion_8 = yes
		}
		remove_point_of_interest = mem_ancestor_herald_poi.2
		every_country = {
			limit = {
				has_event_chain = "mem_lex_ancestor_chain" 
			}
			add_event_chain_counter = { 
				event_chain = "mem_lex_ancestor_chain" 
				counter = "mem_ancestor_herald_counter" 
				amount = 1 
			}
		}
		random_country = {
			limit = { 
				is_country_type = mem_ancestor_guardian
			}
			add_modifier = {
				modifier = "mem_ancestor_herald_debuff_2"
				days = -1
			}
		}
	}
}

country_event = {
	id = mem_ancestor.72
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes

	trigger = {
		is_country_type = mem_ancestor_guardian
		has_country_flag = mem_ancestor_country
		FROMFROM = {
			has_ship_flag = mem_ancestor_herald_3
			is_ship_size = mem_apostle_scout
		}
	}

	immediate = {
		FROMFROM = {
			mem_effect_explosion_8 = yes
		}
		remove_point_of_interest = mem_ancestor_herald_poi.3
		every_country = {
			limit = {
				has_event_chain = "mem_lex_ancestor_chain" 
			}
			add_event_chain_counter = { 
				event_chain = "mem_lex_ancestor_chain" 
				counter = "mem_ancestor_herald_counter" 
				amount = 1 
			}
		}
		random_country = {
			limit = { 
				is_country_type = mem_ancestor_guardian
			}
			add_modifier = {
				modifier = "mem_ancestor_herald_debuff_3"
				days = -1
			}
		}
	}
}

country_event = {
	id = mem_ancestor.73
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes

	trigger = {
		is_country_type = mem_ancestor_guardian
		has_country_flag = mem_ancestor_country
		FROMFROM = {
			has_ship_flag = mem_ancestor_herald_4
			is_ship_size = mem_apostle_scout
		}
	}

	immediate = {
		FROMFROM = {
			mem_effect_explosion_8 = yes
		}
		remove_point_of_interest = mem_ancestor_herald_poi.4
		every_country = {
			limit = {
				has_event_chain = "mem_lex_ancestor_chain" 
			}
			add_event_chain_counter = { 
				event_chain = "mem_lex_ancestor_chain" 
				counter = "mem_ancestor_herald_counter" 
				amount = 1 
			}
		}
		random_country = {
			limit = { 
				is_country_type = mem_ancestor_guardian
			}
			add_modifier = {
				modifier = "mem_ancestor_herald_debuff_4"
				days = -1
			}
		}
	}
}

country_event = {
	id = mem_ancestor.74
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes

	trigger = {
		is_country_type = mem_ancestor_guardian
		has_country_flag = mem_ancestor_country
		FROMFROM = {
			has_ship_flag = mem_ancestor_herald_5
			is_ship_size = mem_apostle_scout
		}
	}

	immediate = {
		FROMFROM = {
			mem_effect_explosion_8 = yes
		}
		remove_point_of_interest = mem_ancestor_herald_poi.5
		every_country = {
			limit = {
				has_event_chain = "mem_lex_ancestor_chain" 
			}
			add_event_chain_counter = { 
				event_chain = "mem_lex_ancestor_chain" 
				counter = "mem_ancestor_herald_counter" 
				amount = 1 
			}
		}
		random_country = {
			limit = { 
				is_country_type = mem_ancestor_guardian
			}
			add_modifier = {
				modifier = "mem_ancestor_herald_debuff_5"
				days = -1
			}
		}
	}
}

country_event = {
	id = mem_ancestor.75
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes

	trigger = {
		is_country_type = mem_ancestor_guardian
		has_country_flag = mem_ancestor_country
		FROMFROM = {
			has_ship_flag = mem_ancestor_herald_6
			is_ship_size = mem_apostle_scout
		}
	}

	immediate = {
		FROMFROM = {
			mem_effect_explosion_8 = yes
		}
		remove_point_of_interest = mem_ancestor_herald_poi.6
		every_country = {
			limit = {
				has_event_chain = "mem_lex_ancestor_chain" 
			}
			add_event_chain_counter = { 
				event_chain = "mem_lex_ancestor_chain" 
				counter = "mem_ancestor_herald_counter" 
				amount = 1 
			}
		}
		random_country = {
			limit = { 
				is_country_type = mem_ancestor_guardian
			}
			add_modifier = {
				modifier = "mem_ancestor_herald_debuff_6"
				days = -1
			}
		}
	}
}

# World Terraformed (HIDDEN)
planet_event = {
	id = mem_ancestor.200
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		every_country = {
			limit = { has_event_chain = "mem_lex_ancestor_chain" }
			add_event_chain_counter = {
				event_chain = "mem_lex_ancestor_chain"
				counter = "mem_ancestor_worlds"
				amount = 1 
			}
		}
	}
}

# Thesan World Cleansed (HIDDEN)
planet_event = {
	id = mem_ancestor.201
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		every_country = {
			limit = { has_event_chain = "mem_lex_ancestor_chain" }
			add_event_chain_counter = {
				event_chain = "mem_lex_ancestor_chain"
				counter = "mem_ancestor_worlds"
				amount = -1 
			}
			add_event_chain_counter = {
				event_chain = "mem_lex_ancestor_chain"
				counter = "mem_ancestor_worlds_cleansed"
				amount = 1 
			}
		}
	}
}

# Thesan Kill Count (HIDDEN)
country_event = {
	id = mem_ancestor.202
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = mem_ancestor_guardian
	}
	
	immediate = {
		if = {
			limit = {
				FROM = { has_event_chain = "mem_lex_ancestor_chain" }
			}
			FROM = {
				add_event_chain_counter = { 
					event_chain = "mem_lex_ancestor_chain" 
					counter = "mem_ancestor_kills_us" 
					amount = 1 
				}
			}
		}
		every_country = {
			limit = { 
				has_event_chain = "mem_lex_ancestor_chain" 
				NOT = { is_same_value = FROM }
			}
			add_event_chain_counter = { 
				event_chain = "mem_lex_ancestor_chain" 
				counter = "mem_ancestor_kills_others" 
				amount = 1 
			}
		}
	}
}

# Thesan Victims (HIDDEN)
country_event = {
	id = mem_ancestor.203
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = mem_ancestor_guardian
	}
	
	immediate = {
		every_country = {
			limit = { has_event_chain = "mem_lex_ancestor_chain" }
			add_event_chain_counter = { 
				event_chain = "mem_lex_ancestor_chain" 
				counter = "mem_ancestor_victims" 
				amount = 1 
			}
		}
	}
}
