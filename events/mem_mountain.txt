# Dragon's Mountain
# By ViolentBeetle

namespace = mem_mountain

# On_Survey; Add dig site
ship_event = {
	id = mem_mountain.1
	title = mem_mountain.1.name
	desc = mem_mountain.1.desc

	is_triggered_only = yes

	picture = GFX_evt_ruined_system
	location = FROM
	show_sound = event_sensor_ping

	trigger = {
		FROM = {
			has_planet_flag = mem_mountain_gas_giant
			NOT = {
				has_global_flag = mem_mountain_dig_spawned
			}
		}
	}

	immediate = {
		set_global_flag = mem_mountain_dig_spawned
		FROM = {
			create_archaeological_site = mem_mountain_gas_giant_dig_site
		}
	}

	option = {
		name = INTERESTING
	}
}

### DIG SITE ONE ###

fleet_event = {
	id = mem_mountain.10
	title = mem_mountain.10.name
	desc = mem_mountain.10.desc

	is_triggered_only = yes
	archaeology = yes

	picture = GFX_evt_ship_offloading_cargo
	show_sound = event_door_opening

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = { 
		from = { set_site_progress_locked = no } 
	}
	
	option = {
		name = DIG
	}
}

fleet_event = {
	id = mem_mountain.11
	title = mem_mountain.11.name
	desc = mem_mountain.11.desc

	is_triggered_only = yes
	archaeology = yes

	picture = GFX_evt_space_station
	show_sound = event_door_opening

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = { 
		from = { set_site_progress_locked = no } 
	}
	
	option = {
		name = DIG
	}
}

fleet_event = {
	id = mem_mountain.12
	title = mem_mountain.12.name
	desc = mem_mountain.12.desc

	is_triggered_only = yes
	archaeology = yes

	picture = GFX_evt_ancient_databank
	show_sound = event_door_opening

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = { 
		from = { set_site_progress_locked = no } 
	}
	
	option = {
		name = DIG
	}
}

fleet_event = {
	id = mem_mountain.13
	title = mem_mountain.13.name
	desc = mem_mountain.13.desc

	is_triggered_only = yes
	archaeology = yes

	picture = GFX_evt_shielded_planet
	show_sound = event_energy_field

	immediate = {
		from = { set_site_progress_locked = yes }
		random_planet = {
			limit = {
				has_planet_flag = mem_mountain_moon
			}
			save_event_target_as = shielded_moon
		}
	}

	after = { 
		from = { set_site_progress_locked = no } 
	}
	
	option = {
		name = mem_mountain.13.a

		event_target:shielded_moon = {
			change_pc = pc_barren_cold
			add_deposit = d_society_5
			create_archaeological_site = mem_mountain_moon_dig_site
		}
	}
}

### DIG SITE TWO ###

fleet_event = {
	id = mem_mountain.20
	title = mem_mountain.20.name
	desc = mem_mountain.20.desc

	is_triggered_only = yes
	archaeology = yes

	picture = GFX_evt_mem_evil_hideout
	show_sound = event_door_opening

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = { 
		from = { set_site_progress_locked = no } 
	}
	
	option = {
		name = DIG
	}
}

fleet_event = {
	id = mem_mountain.21
	title = mem_mountain.21.name
	desc = mem_mountain.21.desc

	is_triggered_only = yes
	archaeology = yes

	picture = GFX_evt_mem_alien_pilgrimage
	show_sound = event_door_opening

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = { 
		from = { set_site_progress_locked = no } 
	}
	
	option = {
		name = DIG
	}
}

fleet_event = {
	id = mem_mountain.22
	title = mem_mountain.22.name
	desc = mem_mountain.22.desc

	is_triggered_only = yes
	archaeology = yes

	picture = GFX_evt_space_dragon_blue
	show_sound = event_door_opening

	immediate = {
		from = { set_site_progress_locked = yes }
		from.planet = { save_event_target_as = the_planet }
	}

	after = { 
		from = { set_site_progress_locked = no } 
	}
	
	option = {
		name = ONSCREEN
		hidden_effect = {
			owner = {
				country_event = { id = mem_mountain.23 }
			}
		}
	}
}

# Diplo with Wyrm
country_event = {
	id = mem_mountain.23
	title = mem_mountain.23.name
	desc = mem_mountain.23.desc

	is_triggered_only = yes
	diplomatic = yes
	location = event_target:the_planet

	picture_event_data = {
		room = no_video_feed_room
	}

	# Kill the dragon
	option = {
		name = mem_mountain.23.a

		hidden_effect = {
			country_event = { id = mem_mountain.24 }
		}

		trigger = {
			NOR = {
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_machine_terminator
				has_valid_civic = civic_hive_devouring_swarm
				is_xenophile = yes
			}
		}

		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				is_xenophobe = yes
			}
		}
	}

	option = {
		name = mem_mountain.23.a.purifier

		hidden_effect = {
			country_event = { id = mem_mountain.24 }
		}

		trigger = {
			OR = {
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_machine_terminator
				has_valid_civic = civic_hive_devouring_swarm
			}
		}

		ai_chance = {
			factor = 10000
		}
	}

	option = {
		name = mem_mountain.23.b
		default_hide_option = yes

		event_target:the_planet = {
			add_deposit = d_society_10
			# add_deposit = d_society_5
		}

		trigger = {
			NOR = {
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_machine_terminator
				has_valid_civic = civic_hive_devouring_swarm
			}
		}

		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				is_gestalt = yes
			}
		}
	}

	option = {
		name = mem_mountain.23.c
		response_text = mem_mountain.23.c.response

		hidden_effect = {
			country_event = {
				id = mem_mountain.25
				days = 7
			}
		}

		trigger = {
			NOR = {
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_machine_terminator
				has_valid_civic = civic_hive_devouring_swarm
				is_xenophobe = yes
			}
		}

		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				is_xenophile = yes
			}
		}
	}

	option = {
		name = mem_mountain.23.d
		is_dialog_only = yes
		response_text = mem_mountain.23.d.tooltip

		ai_chance = {
			factor = 0
		}
	}
	option = {
		name = mem_mountain.23.e
		is_dialog_only = yes
		response_text = mem_mountain.23.e.tooltip

		ai_chance = {
			factor = 0
		}
	}
	option = {
		name = mem_mountain.23.f
		is_dialog_only = yes
		response_text = mem_mountain.23.f.tooltip

		ai_chance = {
			factor = 0
		}
	}
}

# Dragon dies
country_event = {
	id = mem_mountain.24
	title = mem_mountain.24.name
	desc = mem_mountain.24.desc

	is_triggered_only = yes

	location = event_target:the_planet
	picture = GFX_evt_shielded_planet
	show_sound = event_activating_unknown_technology

	option = {
		name = INTERESTING
	}
}

# Dragon is freed
country_event = {
	id = mem_mountain.25
	title = mem_mountain.25.name
	desc = mem_mountain.25.desc

	is_triggered_only = yes

	location = event_target:the_planet
	picture = GFX_evt_space_dragon_blue
	show_sound = event_activating_unknown_technology

	immediate = {
	}

	option = {
		name = ONSCREEN
	}
}