########################
# Sleepers
# Code by Malthus
# Text by ViolentBeetle
########################

namespace = mem_sleepers

################################################################################
################################################################################
################################################################################
 
# Happens on planet with obervation post with either passive or active observation

# Sleepers setup (HIDDEN)
situation_event = {
	id = mem_sleepers.1
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOT = { has_global_flag = mem_sleepers }
		owner = {
			is_regular_pre_ftl = yes
			NOT = { current_awareness_level = full }
			NOT = {
				has_country_flag = benefactor_empire
			}
			OR = {
				has_pre_ftl_age = bronze_age
				has_pre_ftl_age = iron_age
				has_pre_ftl_age = late_medieval_age
				has_pre_ftl_age = renaissance_age
			}
			capital_scope = {
				solar_system = {
					NOR = {
						has_star_flag = mem_ark_system
						has_star_flag = mem_crucible_system
						has_star_flag = mem_wargame_system
						has_star_flag = old_foes_system
					}
				}
				has_observation_outpost = yes
				observation_outpost_owner = {
					is_ai = no
					is_gestalt = no
				}
			}
		}
	}

	immediate = {
		owner.capital_scope = {
			save_event_target_as = the_planet
			set_planet_flag = mem_sleepers_planet
			set_global_flag = mem_sleepers
		}
		owner = {
			save_event_target_as = pre_ftl_country
		}
		owner.capital_scope.observation_outpost_owner = {
			save_event_target_as = mem_sleepers_station_owner
			country_event = { id = mem_sleepers.2 }
		}
		set_situation_flag = has_ongoing_observation_event_chain
		# Setting this flag for the duration of the entire event chain
		# to prevent other observation events from interfering.
	}
}

country_event = {
	id = mem_sleepers.2
	title = mem_sleepers.2.name
	desc = mem_sleepers.2.desc
	picture = GFX_evt_satellite_in_orbit
	show_sound = event_yellow_alert
	location = FROM
	
	is_triggered_only = yes
	
	option = {
		name = mem_sleepers.2.a
		random_system_within_border = {
			limit = {
				any_system_planet = {
					has_planet_flag = mem_sleepers_planet
				}
			}
			random_system_planet = {
				limit = {
					has_planet_flag = mem_sleepers_planet
				}
				enable_special_project = {
					name = "MEM_SLEEPERS_SCAN"
					location = THIS
					owner = ROOT
				}
			}
		}
	}
}

# Failed to do the project (Soft Fail)
country_event = {
	id = mem_sleepers.3
	title = mem_sleepers.3.name
	desc = mem_sleepers.3.desc
	picture = GFX_evt_nuclear_explosion
	show_sound = event_super_explosion
	location = FROMFROMFROM
	
	is_triggered_only = yes

	immediate = {
		random_situation = {
			limit = {
				is_situation_type = pre_ftl_tech_progress_situation
			}
			remove_situation_flag = has_ongoing_observation_event_chain
		}
		random_system_within_border = {
			limit = {
				any_system_planet = {
					has_planet_flag = mem_sleepers_planet
				}
			}
			random_system_planet = {
				limit = {
					has_planet_flag = mem_sleepers_planet
				}
				add_deposit = d_bomb_crater

				random_owned_pop = {
					kill_pop = yes
				}
				
				owner = {
					IF = {
						limit = {
							NOR = {
								has_ethic = ethic_fanatic_spiritualist
								has_ethic = ethic_spiritualist
								has_ethic = ethic_fanatic_materialist
								has_ethic = ethic_materialist
							}
						}
						country_add_ethic = ethic_spiritualist
						every_owned_pop = {
							pop_change_ethic = "ethic_spiritualist"
						}
					}
					IF = {
						limit = {
							has_ethic = ethic_fanatic_materialist	
						}
						country_remove_ethic = ethic_fanatic_materialist
						country_add_ethic = ethic_fanatic_spiritualist
						every_owned_pop = {
							pop_change_ethic = "ethic_spiritualist"
						}
					}
					IF = {
						limit = {
							has_ethic = ethic_materialist	
						}
						country_remove_ethic = ethic_materialist
						country_add_ethic = ethic_spiritualist
						every_owned_pop = {
							pop_change_ethic = "ethic_spiritualist"
						}
					}
				}
			}
		}
	}
	
	option = {
		name = "mem_sleepers.3.a"
	}
}

# Failed to do the project (Hard Fail)
country_event = {
	id = mem_sleepers.4
	title = mem_sleepers.4.name
	desc = mem_sleepers.4.desc
	picture = GFX_evt_nuclear_explosion
	show_sound = event_super_explosion
	location = FROMFROMFROM
	
	is_triggered_only = yes

	immediate = {
		random_system_within_border = {
			limit = {
				any_system_planet = {
					has_planet_flag = mem_sleepers_planet
				}
			}
			random_system_planet = {
				limit = {
					has_planet_flag = mem_sleepers_planet
				}
				observation_outpost = {
					dismantle = yes
				}
				destroy_colony = yes
				change_pc = pc_nuked
				while = {
					count = 2
					add_deposit = d_radioactive_wasteland
				}
				add_deposit = d_active_volcano
			}
		}
	}
	
	option = {
		name = "mem_sleepers.4.a"
		trigger = {       
			NOT = {
				has_ethic = "ethic_fanatic_xenophobe"
			}
		}
	}
	
	option = {
		name = "mem_sleepers.4.b"
		trigger = {
			has_ethic = "ethic_fanatic_xenophobe"
		}
	}
}

ship_event = {
	id = mem_sleepers.5
	title = mem_sleepers.5.name
	desc = mem_sleepers.5.desc
	picture = GFX_evt_mem_horror_corridor
	show_sound = event_airlock
	location = FROMFROMFROM
	
	is_triggered_only = yes
	
	immediate = {
		fleet = {
			set_event_locked = yes
		}
		solar_system = {
			random_system_planet = {
				limit = {
					has_planet_flag = mem_sleepers_planet
				}
				random_owned_pop = {
					save_event_target_as = mem_sleepers_natives
				}
			}
		}
	}
	
	option = {
		name = mem_sleepers.5.a
		custom_tooltip = mem_sleepers.5.a.tooltip
		trigger = {
			owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= 500
				}
			}
		}
		owner= {
			add_resource = {
				energy = -500
			}
		}
		hidden_effect = {
			fleet = {
				set_event_locked = no
			}
			owner = {
				random_list = {
					1 = { country_event = { id = mem_sleepers.45 days = 30} } # Sleepers Awake xenophile
					1 = { country_event = { id = mem_sleepers.95 days = 30} } # Sleepers Awake xenophobe
					2 = { country_event = { id = mem_sleepers.145 days = 30} } # Remnants
					2 = { country_event = { id = mem_sleepers.195 days = 30} } # The Last
				}
			}
		}
	}
	
	option = {
		name = mem_sleepers.5.a
		custom_tooltip = mem_sleepers.5.b.tooltip
		trigger = {
			owner = {
				resource_stockpile_compare = {
					resource = energy
					value < 500
				}
			}
		}
		owner = {
			add_modifier = {
				modifier = mem_sleepers_energy_cost
				days = 1500
			}
		}
		hidden_effect = {
			fleet = {
				set_event_locked = no
			}
			owner = {
				random_list = {
					1 = { country_event = { id = mem_sleepers.45 days = 30} } # Sleepers Awake xenophile
					1 = { country_event = { id = mem_sleepers.95 days = 30} } # Sleepers Awake xenophobe
					2 = { country_event = { id = mem_sleepers.145 days = 30} } # Remnants
					2 = { country_event = { id = mem_sleepers.195 days = 30} } # The Last
				}
			}
		}
	}
	
	option = {
		name = mem_sleepers.5.c
		custom_tooltip = mem_sleepers.5.c.tooltip
		trigger = {
			owner = {
				NOR = {
					has_ethic = ethic_fanatic_xenophile
					has_ethic = ethic_xenophile
				}
			}
		}
		hidden_effect = {
			owner = {
				random_list = {
					3 = { country_event = { id = mem_sleepers.6 days = 30} } # Getting some Loot and Research
					1 = { country_event = { id = mem_sleepers.7 days = 30} } # Some sleepers awake and destroy the vault
				}
			}
		}
	}
	
	option = {
		name = mem_sleepers.5.d
		trigger = {
			owner = {
				has_ethic = ethic_fanatic_xenophobe
			}
		}
		owner = {
			add_resource = {
				influence = 100
			}
		}
		hidden_effect = {
			fleet = {
				set_event_locked = no
			}
			owner = {
				random_list = {
					80 = { country_event = { id = mem_sleepers.8 days = 30} } # small Explosion
					20 = { country_event = { id = mem_sleepers.9 days = 30} } # big Explosion
				}
			}
		}
	}
}

#Looting the Vault and potentially getting uplifting tech option
country_event = {
	id = mem_sleepers.6
	title = mem_sleepers.6.name
	desc = mem_sleepers.6.desc
	picture = GFX_evt_mem_horror_corridor
	show_sound = event_laboratory_sound
	location = FROMFROMFROMFROM
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			fleet = {
				set_event_locked = no
			}
			solar_system = {
				random_system_planet = {
					limit = {
						has_planet_flag = mem_sleepers_planet
					}
					random_owned_pop = {
						save_event_target_as = mem_sleepers_natives
					}
				}
			}
		}
	}
	
	option = {
		name = mem_sleepers.6.a
		add_monthly_resource_mult = {
			resource = energy
			value = @tier1materialreward
			min = @tier1materialmin
			max = @tier1materialmax
		}
		add_monthly_resource_mult = {
			resource = minerals
			value = @tier2materialreward
			min = @tier2materialmin
			max = @tier2materialmax
		}
		IF = {
			limit = {
				NOT = {
					has_technology = tech_epigenetic_triggers
				}
			}
			add_research_option = tech_epigenetic_triggers
			add_tech_progress = {
				tech = tech_epigenetic_triggers
				progress = 0.3
			} 
		}
		ELSE = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
		}
	}
}

#Some sleepers awake and attack your looting team (small explosion) Scientist dies
country_event = {
	id = mem_sleepers.7
	title = mem_sleepers.7.name
	desc = mem_sleepers.7.desc
	picture = GFX_evt_nuclear_explosion
	show_sound =  event_ground_battle
	location = FROMFROMFROMFROM
	
	is_triggered_only = yes
	
	immediate = {
		random_system_within_border = {
			limit = {
				any_system_planet = {
					has_planet_flag = mem_sleepers_planet
				}
			}
			random_system_planet = {
				limit = {
					has_planet_flag = mem_sleepers_planet
				}
				add_deposit = d_bomb_crater
				owner = {
					IF = {
						limit = {
							NOR = {
								has_ethic = ethic_fanatic_spiritualist
								has_ethic = ethic_spiritualist
								has_ethic = ethic_fanatic_materialist
								has_ethic = ethic_materialist
							}
						}
						country_add_ethic = ethic_spiritualist
						every_owned_pop = {
							pop_change_ethic = "ethic_spiritualist"
						}
					}
					IF = {
						limit = {
							has_ethic = ethic_fanatic_materialist	
						}
						country_remove_ethic = ethic_fanatic_materialist
						country_add_ethic = ethic_fanatic_spiritualist
						every_owned_pop = {
							pop_change_ethic = "ethic_spiritualist"
						}
					}
					IF = {
						limit = {
							has_ethic = ethic_materialist	
						}
						country_remove_ethic = ethic_materialist
						country_add_ethic = ethic_spiritualist
						every_owned_pop = {
							pop_change_ethic = "ethic_spiritualist"
						}
					}
				}
			}
		}
		FROM = {
			fleet = {
				kill_leader = { type = scientist show_notification = no}
			}
		}
	}
	
	option = {
		name = mem_sleepers.7.a
		hidden_effect = {
			FROM = {
				fleet = {
					set_event_locked = no
				}
			}
		}
	}
}

#Letting it blow up as a xenophobe (small)
country_event = {
	id = mem_sleepers.8
	title = mem_sleepers.8.name
	desc = mem_sleepers.8.desc
	picture = GFX_evt_nuclear_explosion
	show_sound = event_super_explosion
	location = FROMFROMFROMFROM
	
	is_triggered_only = yes

	immediate = {
		random_system_within_border = {
			limit = {
				any_system_planet = {
					has_planet_flag = mem_sleepers_planet
				}
			}
			random_system_planet = {
				limit = {
					has_planet_flag = mem_sleepers_planet
				}
				add_deposit = d_bomb_crater
				owner = {
					IF = {
						limit = {
							NOR = {
								has_ethic = ethic_fanatic_spiritualist
								has_ethic = ethic_spiritualist
								has_ethic = ethic_fanatic_materialist
								has_ethic = ethic_materialist
							}
						}
						country_add_ethic = ethic_spiritualist
						every_owned_pop = {
							pop_change_ethic = "ethic_spiritualist"
						}
					}
					IF = {
						limit = {
							has_ethic = ethic_fanatic_materialist	
						}
						country_remove_ethic = ethic_fanatic_materialist
						country_add_ethic = ethic_fanatic_spiritualist
						every_owned_pop = {
							pop_change_ethic = "ethic_spiritualist"
						}
					}
					IF = {
						limit = {
							has_ethic = ethic_materialist	
						}
						country_remove_ethic = ethic_materialist
						country_add_ethic = ethic_spiritualist
						every_owned_pop = {
							pop_change_ethic = "ethic_spiritualist"
						}
					}
				}
			}
		}
	}
	
	option = {
		name = "mem_sleepers.8.a"
	}
}

#Letting it blow up as a xenophobe (big)
country_event = {
	id = mem_sleepers.9
	title = mem_sleepers.9.name
	desc = mem_sleepers.9.desc
	picture = GFX_evt_nuclear_explosion
	show_sound = event_super_explosion
	location = FROMFROMFROMFROM
	
	is_triggered_only = yes

	immediate = {
		random_system_within_border = {
			limit = {
				any_system_planet = {
					has_planet_flag = mem_sleepers_planet
				}
			}
			random_system_planet = {
				limit = {
					has_planet_flag = mem_sleepers_planet
				}
				observation_outpost = {
					dismantle = yes
				}
				destroy_colony = yes
				change_pc = pc_nuked
				while = {
					count = 2
					add_deposit = d_radioactive_wasteland
				}
				add_deposit = d_active_volcano
			}
		}
	}
	
	option = {
		name = "mem_sleepers.9.a"
	}
}

#Sleepers Awake (xenophile) prelude narration
country_event = {
	id = mem_sleepers.45
	title = mem_sleepers.45.name
	desc = mem_sleepers.45.desc
	picture = GFX_evt_mem_laboratory
	show_sound = event_laboratory_sound
	location = FROM.FROMFROMFROM
	
	is_triggered_only = yes
	
	option = {
		name = mem_sleepers.45.a
		custom_tooltip = mem_sleepers.45.a.tooltip
		hidden_effect = {
			country_event = { id = mem_sleepers.50 }
		}
	}
}

#Sleepers Awake xenophile
country_event = {
	id = mem_sleepers.50
	title = mem_sleepers.50.name
	desc = mem_sleepers.50.desc
	
	is_triggered_only = yes
	
	diplomatic = yes
	
	immediate = {
		FROMFROMFROMFROM = {
			create_species = {
				name = "NAME_Ozari"
				class = random_non_machine
				portrait = random
				homeworld = THIS
				traits = {
					trait = trait_natural_sociologists
					trait = trait_venerable
					trait = trait_sedentary
				}
			}
			create_country = {
				name = "NAME_Ozari_Remnants"
				species = last_created_species
				type = adversary
				ethos = {
					ethic = ethic_xenophile
					ethic = ethic_pacifist
					ethic = ethic_materialist
				}
				auto_delete = no
				flag = {
					icon = {
						category = "spherical"
						file = "flag_spherical_1.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"green"
						"black"
						"null"
						"null"
					}
				}
			}
			last_created_country = {
				set_relation_flag = {
					who = event_target:mem_sleepers_station_owner
					flag = mem_sleepers
				}
				set_country_flag = mem_sleepers_country
				establish_communications_no_message = event_target:mem_sleepers_station_owner
				save_event_target_as = mem_sleepers_country
				owner_species = { save_event_target_as = mem_sleepers_species }
			}
			if = {
				limit = {
					any_owned_planet = {
						habitability = {
							who = event_target:mem_sleepers_country.species
							value > 0.75
						}
					}
				}
				random_owned_planet = {
					limit = {
						habitability = {
							who = event_target:mem_sleepers_country.species
							value > 0.75
						}
					}
					create_pop = { 
						species = event_target:mem_sleepers_country
						ethos = event_target:mem_sleepers_country
					}
				}
			}
			else_if = {
				limit = {
					any_owned_planet = {
						habitability = {
							who = event_target:mem_sleepers_country.species
							value > 0.5
						}
					}
				}
				random_owned_planet = {
					limit = {
						habitability = {
							who = event_target:mem_sleepers_country.species
							value > 0.5
						}
					}
					create_pop = { 
						species = event_target:mem_sleepers_country
						ethos = event_target:mem_sleepers_country
					}
				}
			}
			else = {
				random_owned_planet = {
					create_pop = { 
						species = event_target:mem_sleepers_country
						ethos = event_target:mem_sleepers_country
					}
				}
			}
		}
		country_event = { id = mem_sleepers.51 days = 60 }
	}
	
	picture_event_data = {
		portrait = event_target:mem_sleepers_country
		room = mem_server_room
	}

	option = {
		name = mem_sleepers.50.a
		response_text = mem_sleepers.50.a.response
	}
}

#Sleepers meet natives - player choice if integrating, protectorate or free empire
country_event = {
	id = mem_sleepers.51
	title = mem_sleepers.51.name
	desc = mem_sleepers.51.desc
	picture = GFX_evt_mem_native_interaction
	show_sound = event_pre_ftl_civilization
	location = FROMFROMFROMFROM.FROM
	
	is_triggered_only = yes
	
	immediate = {
		random_system_within_border = {
			limit = {
				any_system_planet = {
					has_planet_flag = mem_sleepers_planet
				}
			}
			random_system_planet = {
				limit = {
					has_planet_flag = mem_sleepers_planet
				}
				save_event_target_as = sleepers_planet
				owner = {
					IF = {
						limit = {
							NOR = {
								has_ethic = ethic_fanatic_xenophobe
								has_ethic = ethic_xenophobe
								has_ethic = ethic_fanatic_xenophile
								has_ethic = ethic_xenophile
							}
						}
						country_add_ethic = ethic_xenophile
						every_owned_pop = {
							pop_change_ethic = "ethic_xenophile"
						}
					}
					IF = {
						limit = {
							has_ethic = ethic_fanatic_xenophobe	
						}
						country_remove_ethic = ethic_fanatic_xenophobe
						country_add_ethic = ethic_fanatic_xenophile
						every_owned_pop = {
							pop_change_ethic = "ethic_xenophile"
						}
					}
					IF = {
						limit = {
							has_ethic = ethic_xenophobe	
						}
						country_remove_ethic = ethic_xenophobe
						country_add_ethic = ethic_xenophile
						every_owned_pop = {
							pop_change_ethic = "ethic_xenophile"
						}
					}
				}
			}
		}
	}
	
	#integrate them peacefully
	option = {
		name = mem_sleepers.51.a
		custom_tooltip = mem_sleepers.51.a.tooltip
		hidden_effect = {
			event_target:sleepers_planet = {
				observation_outpost = {
					dismantle = yes
				}
				every_planet_army = {
					remove_army = yes
				}
				set_owner = ROOT
			}
		}
	}
	
	#make them a protectorate
	option = {
		name = mem_sleepers.51.b
		custom_tooltip = mem_sleepers.51.b.tooltip
		hidden_effect = {
			event_target:sleepers_planet = {
				observation_outpost = {
					dismantle = yes
				}
				owner = {
					set_pre_ftl_age_effect = { PRE_FTL_AGE = early_space_age }
					country_event = { id = mem_sleepers.52 }
					country_event = { id = mem_sleepers.5201 days = 3 }
					event_target:sleepers_planet.solar_system.starbase = {
						set_owner = prev
					}
					set_subject_of = {
						who = root
						preset = preset_protectorate
					}
				}
			}
		}
	}
	
	#make them a free empire
	option = {
		name = mem_sleepers.51.c
		trigger = {
			NOT = {
				has_ethic = ethic_fanatic_xenophobe
			}
		}
		custom_tooltip = mem_sleepers.51.c.tooltip
		hidden_effect = {
			event_target:sleepers_planet = {
				observation_outpost = {
					dismantle = yes
				}
				owner = {
					set_pre_ftl_age_effect = { PRE_FTL_AGE = early_space_age }
					country_event = { id = mem_sleepers.52 }
					country_event = { id = mem_sleepers.5201 days = 3 }
					event_target:sleepers_planet.solar_system.starbase = {
						set_owner = prev
					}
				}
			}
		}
	}
	
	#make them a free empire
	option = {
		name = mem_sleepers.51.d
		trigger = {
			has_ethic = ethic_fanatic_xenophobe
		}
		custom_tooltip = mem_sleepers.51.c.tooltip
		hidden_effect = {
			event_target:sleepers_planet = {
				observation_outpost = {
					dismantle = yes
				}
				owner = {
					set_pre_ftl_age_effect = { PRE_FTL_AGE = early_space_age }
					country_event = { id = mem_sleepers.52 }
					country_event = { id = mem_sleepers.5201 days = 3 }
					event_target:sleepers_planet.solar_system.starbase = {
						set_owner = prev
					}
				}
			}
		}
	}
}

country_event = {
	id = mem_sleepers.5201
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		establish_communications_no_message = from
		If = {
			limit = {
				NOR = {
					has_ethic= ethic_xenophobe
					has_ethic= ethic_fanatic_xenophobe
				}				
			}
			set_empire_flag = {
				icon = {
					category = "spherical"
					file = "flag_spherical_1.dds"
				}
				background= {
					category = "backgrounds"
					file = "new_dawn.dds"
				}
				colors={
					"green"
					"black"
					"null"
					"null"
				}
			}
		}
		else = {
			set_empire_flag = {
				icon = {
					category = "spherical"
					file = "flag_spherical_1.dds"
				}
				background= {
					category = "backgrounds"
					file = "new_dawn.dds"
				}
				colors={
					"red"
					"black"
					"null"
					"null"
				}
			}
		}
	}
}

#Sleepers Entering Space Age (HIDDEN)
country_event = {
	id = mem_sleepers.52
	hide_window = yes
	
	trigger = {
		is_country_type = primitive
		has_country_flag = early_space_age
	}
	
	is_triggered_only = yes
	
	immediate = {
		change_dominant_species = {
			species = event_target:mem_sleepers_species
		}
		if = {
			limit = {
				has_awareness >= 100
			}
			set_country_flag = knew_of_aliens
		}
		achieve_ftl_effect = {
			PRE_FTL = root
			OWNER = root
		}
		#making sure the country has the correct ethics
		IF = {
			limit = {
				has_ethic = ethic_fanatic_authoritarian
			}
			country_remove_ethic = ethic_fanatic_authoritarian 
		}
		IF = {
			limit = {
				NOT = {
					has_ethic = ethic_pacifist
				}
			}
			country_add_ethic = ethic_pacifist 
		}
		IF = {
			limit = {
				has_ethic = ethic_fanatic_egalitarian
			}
			country_remove_ethic = ethic_fanatic_egalitarian 
		}
		IF = {
			limit = {
				has_ethic = ethic_egalitarian
			}
			country_remove_ethic = ethic_egalitarian 
		}
		IF = {
			limit = {
				has_ethic = ethic_fanatic_xenophobe
			}
			country_remove_ethic = ethic_fanatic_xenophobe 
		}
		IF = {
			limit = {
				has_ethic = ethic_xenophobe
			}
			country_remove_ethic = ethic_xenophobe 
		}
		IF = {
			limit = {
				has_ethic = ethic_fanatic_xenophile
			}
			country_remove_ethic = ethic_fanatic_xenophile 
		}
		IF = {
			limit = {
				NOT = {
					has_ethic = ethic_xenophile
				}
			}
			country_add_ethic = ethic_xenophile 
		}
		IF = {
			limit = {
				has_ethic = ethic_fanatic_militarist
			}
			country_remove_ethic = ethic_fanatic_militarist 
		}
		IF = {
			limit = {
				has_ethic = ethic_militarist
			}
			country_remove_ethic = ethic_militarist 
		}
		IF = {
			limit = {
				has_ethic = ethic_fanatic_pacifist
			}
			country_remove_ethic = ethic_fanatic_pacifist 
		}
		IF = {
			limit = {
				has_ethic = ethic_authoritarian
			}
			country_remove_ethic = ethic_authoritarian 
		}
		IF = {
			limit = {
				has_ethic = ethic_fanatic_spiritualist
			}
			country_remove_ethic = ethic_fanatic_spiritualist 
		}
		IF = {
			limit = {
				has_ethic = ethic_spiritualist
			}
			country_remove_ethic = ethic_spiritualist 
		}
		IF = {
			limit = {
				NOT = {
					has_ethic = ethic_materialist
				}
			}
			country_add_ethic = ethic_materialist 
		}
		IF = {
			limit = {
				has_ethic = ethic_fanatic_materialist
			}
			country_remove_ethic = ethic_fanatic_materialist 
		}
		change_government = {
			authority = "auth_democratic"
			civics = {
				civic = civic_free_haven
				civic = civic_technocracy
			}
		}
		set_name = "Ozari Commonwealth"
		create_leader = {
			class = governor
			species = owner_main_species
			name = random
			skill = 1
			traits = {
				trait = trait_ruler_champion_of_the_people
				trait = trait_ruler_fertility_preacher
			}
		}
		assign_leader = last_created_leader
	}
}

#Sleepers Awake (xenophobe) prelude narration
#Uses (xenophile) version localisation
country_event = {
	id = mem_sleepers.95
	title = mem_sleepers.45.name
	desc = mem_sleepers.45.desc
	picture = GFX_evt_mem_laboratory
	show_sound = event_laboratory_sound
	location = FROM.FROMFROMFROM
	
	is_triggered_only = yes
	
	option = {
		name = mem_sleepers.45.a
		custom_tooltip = mem_sleepers.45.a.tooltip
		hidden_effect = {
			country_event = { id = mem_sleepers.100 }
		}
	}
}

#Sleepers Awake xenophobe (uses texts of xenophile path)
country_event = {
	id = mem_sleepers.100
	title = mem_sleepers.50.name
	desc = mem_sleepers.50.desc
	
	is_triggered_only = yes
	
	diplomatic = yes
	
	immediate = {
		FROMFROMFROMFROM = {
			create_species = {
				name = "NAME_Ozari"
				class = random_non_machine
				portrait = random
				homeworld = THIS
				traits = {
					trait = trait_natural_sociologists
					trait = trait_venerable
					trait = trait_sedentary
				}
			}
			create_country = {
				name = "NAME_Ozari_Remnants"
				species = last_created_species
				type = adversary
				ethos = {
					ethic = ethic_fanatic_xenophobe
					ethic = ethic_authoritarian
				}
				auto_delete = no
				flag = {
					icon = {
						category = "spherical"
						file = "flag_spherical_1.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"red"
						"black"
						"null"
						"null"
					}
				}
			}
			last_created_country = {
				set_relation_flag = {
					who = event_target:mem_sleepers_station_owner
					flag = mem_sleepers
				}
				set_country_flag = mem_sleepers_country
				establish_communications_no_message = event_target:mem_sleepers_station_owner
				save_event_target_as = mem_sleepers_country
				owner_species = { save_event_target_as = mem_sleepers_species }
			}
			while = {
				count = 5
				create_pop = { 
					species = event_target:mem_sleepers_country
					ethos = event_target:mem_sleepers_country
				}
				last_created_pop = {
					set_pop_flag = mem_sleepers_ozari
				}
			}			
		}
		country_event = { id = mem_sleepers.101 days = 60 }
	}
	
	picture_event_data = {
		portrait = event_target:mem_sleepers_country
		room = mem_server_room
	}

	option = {
		name = mem_sleepers.50.a
		response_text = mem_sleepers.50.a.response
	}
}

#Sleepers meet natives - player choice if integrating, protectorate or free empire
country_event = {
	id = mem_sleepers.101
	title = mem_sleepers.101.name
	desc = mem_sleepers.101.desc
	picture = GFX_evt_mem_ground_combat
	show_sound = event_ground_battle
	location = FROMFROMFROMFROM.FROM
	
	is_triggered_only = yes

	immediate = {
		random_system_within_border = {
			limit = {
				any_system_planet = {
					has_planet_flag = mem_sleepers_planet
				}
			}
			random_system_planet = {
				limit = {
					has_planet_flag = mem_sleepers_planet
				}
				save_event_target_as = sleepers_planet
			}
		}
	}
	
	#integrate them peacefully
	option = {
		name = mem_sleepers.101.a
		trigger = {
			NOR = {
				has_ethic = ethic_fanatic_xenophile
				has_ethic = ethic_xenophile
				has_ethic = ethic_fanatic_xenophobe
			}
		}
		custom_tooltip = mem_sleepers.101.a.tooltip
		hidden_effect = {	
			event_target:sleepers_planet = {
				every_owned_pop = {
					limit = {
						NOT = {
							has_pop_flag = mem_sleepers_ozari
						}
					}
					kill_pop = yes
				}
				observation_outpost = {
					dismantle = yes
				}
				every_planet_army = {
					remove_army = yes
				}
				set_owner = ROOT
			}			
		}
	}
	
	#integrate them peacefully
	option = {
		name = mem_sleepers.101.a.xenophobe
		trigger = {
			has_ethic = ethic_fanatic_xenophobe
		}
		custom_tooltip = mem_sleepers.101.a.tooltip
		hidden_effect = {	
			event_target:sleepers_planet = {
				every_owned_pop = {
					limit = {
						NOT = {
							has_pop_flag = mem_sleepers_ozari
						}
					}
					kill_pop = yes
				}
				observation_outpost = {
					dismantle = yes
				}
				every_planet_army = {
					remove_army = yes
				}
				set_owner = ROOT
			}			
		}
	}
	
	#make them a protectorate
	option = {
		name = mem_sleepers.101.b
		trigger = {
			NOR = {
				has_ethic = ethic_fanatic_xenophile
				has_ethic = ethic_xenophile
			}
		}
		custom_tooltip = mem_sleepers.101.b.tooltip
		hidden_effect = {	
			event_target:sleepers_planet = {
				every_owned_pop = {
					limit = {
						NOT = {
							has_pop_flag = mem_sleepers_ozari
						}
					}
					kill_pop = yes
				}
				observation_outpost = {
					dismantle = yes
				}
				owner = {
					set_pre_ftl_age_effect = { PRE_FTL_AGE = early_space_age }
					country_event = { id = mem_sleepers.102 }
					country_event = { id = mem_sleepers.5201 days = 3 }
					event_target:sleepers_planet.solar_system.starbase = {
						set_owner = prev
					}
					set_subject_of = {
						who = root
						preset = preset_protectorate
					}					
				}
			}			
		}
	}
	
	#make them a free empire
	option = {
		name = mem_sleepers.101.c
		trigger = {
			NOT = {
				has_ethic = ethic_fanatic_xenophobe
			}
		}
		custom_tooltip = mem_sleepers.51.c.tooltip
		hidden_effect = {
			event_target:sleepers_planet = {
				every_owned_pop = {
					limit = {
						NOT = {
							has_pop_flag = mem_sleepers_ozari
						}
					}
					kill_pop = yes
				}
				observation_outpost = {
					dismantle = yes
				}
				owner = {
					set_pre_ftl_age_effect = { PRE_FTL_AGE = early_space_age }
					country_event = { id = mem_sleepers.102 }
					country_event = { id = mem_sleepers.5201 days = 3 }
					event_target:sleepers_planet.solar_system.starbase = {
						set_owner = prev
					}
				}
			}
		}
	}
	
	#make them a free empire
	option = {
		name = mem_sleepers.51.d
		trigger = {
			has_ethic = ethic_fanatic_xenophobe
		}
		custom_tooltip = mem_sleepers.51.c.tooltip
		hidden_effect = {
			event_target:sleepers_planet = {
				every_owned_pop = {
					limit = {
						NOT = {
							has_pop_flag = mem_sleepers_ozari
						}
					}
					kill_pop = yes
				}
				observation_outpost = {
					dismantle = yes
				}
				owner = {
					set_pre_ftl_age_effect = { PRE_FTL_AGE = early_space_age }
					country_event = { id = mem_sleepers.102 }
					country_event = { id = mem_sleepers.5201 days = 3 }
					event_target:sleepers_planet.solar_system.starbase = {
						set_owner = prev
					}
				}
			}
		}
	}
}

#Sleepers Entering Space Age (HIDDEN)
country_event = {
	id = mem_sleepers.102
	hide_window = yes
	
	trigger = {
		is_country_type = primitive
		has_country_flag = early_space_age
	}
	
	is_triggered_only = yes
	
	immediate = {
		change_dominant_species = {
			species = event_target:mem_sleepers_species
		}
		if = {
			limit = {
				has_awareness >= 100
			}
			set_country_flag = knew_of_aliens
		}
		achieve_ftl_effect = {
			PRE_FTL = root
			OWNER = root
		}
		#making sure the country has the correct ethics
		IF = {
			limit = {
				has_ethic = ethic_fanatic_authoritarian
			}
			country_remove_ethic = ethic_fanatic_authoritarian
		}
		IF = {
			limit = {
				NOT = {
					has_ethic = ethic_authoritarian
				}
			}
			country_add_ethic = ethic_authoritarian 
		}
		IF = {
			limit = {
				has_ethic = ethic_fanatic_egalitarian
			}
			country_remove_ethic = ethic_fanatic_egalitarian 
		}
		IF = {
			limit = {
				has_ethic = ethic_egalitarian
			}
			country_remove_ethic = ethic_egalitarian 
		}
		IF = {
			limit = {
				NOT = {
					has_ethic = ethic_fanatic_xenophobe
				}
			}
			country_add_ethic = ethic_fanatic_xenophobe 
		}
		IF = {
			limit = {
				has_ethic = ethic_xenophobe
			}
			country_remove_ethic = ethic_xenophobe 
		}
		IF = {
			limit = {
				has_ethic = ethic_fanatic_xenophile
			}
			country_remove_ethic = ethic_fanatic_xenophile 
		}
		IF = {
			limit = {
				has_ethic = ethic_xenophile
			}
			country_remove_ethic = ethic_xenophile 
		}
		IF = {
			limit = {
				has_ethic = ethic_fanatic_militarist
			}
			country_remove_ethic = ethic_fanatic_militarist 
		}
		IF = {
			limit = {
				has_ethic = ethic_militarist
			}
			country_remove_ethic = ethic_militarist 
		}
		IF = {
			limit = {
				has_ethic = ethic_fanatic_pacifist
			}
			country_remove_ethic = ethic_fanatic_pacifist 
		}
		IF = {
			limit = {
				has_ethic = ethic_pacifist
			}
			country_remove_ethic = ethic_pacifist 
		}
		IF = {
			limit = {
				has_ethic = ethic_fanatic_spiritualist
			}
			country_remove_ethic = ethic_fanatic_spiritualist 
		}
		IF = {
			limit = {
				has_ethic = ethic_spiritualist
			}
			country_remove_ethic = ethic_spiritualist 
		}
		IF = {
			limit = {
				has_ethic = ethic_materialist
			}
			country_remove_ethic = ethic_materialist 
		}
		IF = {
			limit = {
				has_ethic = ethic_fanatic_materialist
			}
			country_remove_ethic = ethic_fanatic_materialist 
		}
		change_government = {
			authority = "auth_imperial"
			civics = {
				civic = civic_functional_architecture
				civic = civic_police_state
			}
		}
		set_name = "Ozari Dominion"
		create_leader = {
			class = general
			species = owner_main_species
			name = random
			skill = 1
			traits = {
				trait = trait_ruler_warlike
				trait = trait_ruler_industrialist
			}
		}
		assign_leader = last_created_leader
	}
}

#Remnants prelude narration
country_event = {
	id = mem_sleepers.145
	title = mem_sleepers.145.name
	desc = mem_sleepers.145.desc
	picture = GFX_evt_mem_horror_corridor
	show_sound = event_laboratory_sound
	location = FROM.FROMFROMFROM
	
	is_triggered_only = yes
	
	option = {
		name = mem_sleepers.145.a
		custom_tooltip = mem_sleepers.145.a.tooltip
		hidden_effect = {
			country_event = { id = mem_sleepers.150 }
		}
	}
}

#Remnants
country_event = {
	id = mem_sleepers.150
	title = mem_sleepers.150.name
	desc = mem_sleepers.150.desc
	
	is_triggered_only = yes
	
	diplomatic = yes
	
	immediate = {
		FROMFROMFROMFROM = {
			create_species = {
				name = "NAME_Ozari"
				class = random_non_machine
				portrait = random
				homeworld = THIS
				traits = {
					trait = trait_natural_sociologists
					trait = trait_venerable
					trait = trait_sedentary
				}
			}
			create_country = {
				name = "NAME_Ozari_Remnants"
				species = last_created_species
				type = adversary
				ethos = {
					ethic = ethic_xenophile
					ethic = ethic_pacifist
					ethic = ethic_materialist
				}
				auto_delete = no
				flag = {
					icon = {
						category = "spherical"
						file = "flag_spherical_1.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"green"
						"black"
						"null"
						"null"
					}
				}
			}
			last_created_country = {
				set_relation_flag = {
					who = event_target:mem_sleepers_station_owner
					flag = mem_sleepers
				}
				set_country_flag = mem_sleepers_country
				establish_communications_no_message = event_target:mem_sleepers_station_owner
				save_event_target_as = mem_sleepers_country
				owner_species = { save_event_target_as = mem_sleepers_species }
			}
		}
	}
	
	picture_event_data = {
		portrait = event_target:mem_sleepers_country
		room = mem_corridor_room
	}

	option = {
		name = mem_sleepers.150.a
		custom_tooltip = mem_sleepers.150.a.tooltip
		response_text = mem_sleepers.150.a.response
		add_modifier = {
			modifier = mem_sleepers_research_boost
			days = -1
		}
		hidden_effect = {
			country_event = { id = mem_sleepers.151 days = 12600 random = 3600 }
		}
	}
	
	option = {
		name = mem_sleepers.150.b
		response_text = mem_sleepers.150.b.response
		add_resource = {
			influence = 75
		}
		hidden_effect = {
			country_event = { id = mem_sleepers.152 days = 1700 random = 200 }
		}
	}
	
	option = {
		name = mem_sleepers.150.c
		trigger = {
			has_ethic = ethic_fanatic_xenophobe
		}
		response_text = mem_sleepers.150.c.response
		add_resource = {
			influence = 150
		}
	}
}

#Last Ozari dies
country_event = {
	id = mem_sleepers.151
	title = mem_sleepers.151.name
	desc = mem_sleepers.151.desc
	picture = GFX_evt_genetic_modification
	show_sound = event_default
	
	is_triggered_only = yes 
	
	option = {
		name = mem_sleepers.151.a
		trigger = {
			NOT = {
				has_ethic = ethic_fanatic_xenophobe
			}
		}
		remove_modifier = mem_sleepers_research_boost
		# starts the elusive carcosa event at 75% chance if it has not already happened
		hidden_effect = {
			IF = {
				limit = {
					NOT = { has_global_flag = mem_elusive_carcosa }
					num_owned_planets > 4
				}
				random_list = {
					75 = {
						random_owned_planet = {
							limit = {
								is_colony = yes
								is_capital = no
							}
							save_global_event_target_as = mem_carcosa_colony
						}
						country_event = { id = mem_elusive_carcosa.11 days = 40 random = 15 }
					}
					25 = {}
				}
			}
		}
	}
	
	option = {
		name = mem_sleepers.151.b
		trigger = {
			has_ethic = ethic_fanatic_xenophobe
		}
		remove_modifier = mem_sleepers_research_boost
		# starts the elusive carcosa event at 75% chance if it has not already happened
		hidden_effect = {
			IF = {
				limit = {
					NOT = { has_global_flag = mem_elusive_carcosa }
					num_owned_planets > 4
				}
				random_list = {
					75 = {
						random_owned_planet = {
							limit = {
								is_colony = yes
								is_capital = no
							}
							save_global_event_target_as = mem_carcosa_colony
						}
						country_event = { id = mem_elusive_carcosa.11 days = 40 random = 15 }
					}
					25 = {}
				}
			}
		}
	}
}

#Primitive civilization evolves with help of Ozari
country_event = {
	id = mem_sleepers.152
	title = mem_sleepers.152.name
	desc = mem_sleepers.152.desc
	picture = GFX_evt_medieval_alien_civilization
	show_sound = event_pre_ftl_civilization
	location = FROMFROMFROMFROM.FROM
	
	is_triggered_only = yes
	
	trigger = {
		any_system_within_border = {
			any_system_planet = {
				has_planet_flag = mem_sleepers_planet
				has_observation_outpost = yes
				owner = {
					is_country_type = primitive
					OR = {
						has_country_flag = bronze_age
						has_country_flag = iron_age
						has_country_flag = late_medieval_age
						has_country_flag = renaissance_age
					}
				}
			}
		}
	}
	
	immediate = {
		random_galaxy_planet = {
			limit = {
				has_planet_flag = mem_sleepers_planet
			}
			owner = {
				set_pre_ftl_age_effect = { PRE_FTL_AGE = steam_age }
			}
		}
	}
	
	option = {
		name = mem_sleepers.152.a
	}
}

#The Last prelude narration
country_event = {
	id = mem_sleepers.195
	title = mem_sleepers.195.name
	desc = mem_sleepers.195.desc
	picture = GFX_evt_mem_horror_corridor
	show_sound = event_laboratory_sound
	location = FROM.FROMFROMFROM
	
	is_triggered_only = yes
	
	option = {
		name = mem_sleepers.195.a
		custom_tooltip = mem_sleepers.195.a.tooltip
		hidden_effect = {
			country_event = { id = mem_sleepers.200 }
		}
	}
}

#The Last
country_event = {
	id = mem_sleepers.200
	title = mem_sleepers.200.name
	desc = mem_sleepers.200.desc
	
	is_triggered_only = yes
	
	diplomatic = yes
	
	immediate = {
		FROMFROMFROMFROM = {
			create_species = {
				name = "NAME_Ozari"
				class = random_non_machine
				portrait = random
				homeworld = THIS
				traits = {
					trait = trait_natural_sociologists
					trait = trait_venerable
					trait = trait_sedentary
				}
			}
			create_country = {
				name = "NAME_Ozari_Remnant"
				species = last_created_species
				type = adversary
				ethos = {
					ethic = ethic_xenophile
					ethic = ethic_pacifist
					ethic = ethic_materialist
				}
				auto_delete = no
				flag = {
					icon = {
						category = "spherical"
						file = "flag_spherical_1.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"green"
						"black"
						"null"
						"null"
					}
				}
			}
			last_created_country = {
				set_relation_flag = {
					who = event_target:mem_sleepers_station_owner
					flag = mem_sleepers
				}
				set_country_flag = mem_sleepers_country
				establish_communications_no_message = event_target:mem_sleepers_station_owner
				save_event_target_as = mem_sleepers_country
				owner_species = { save_event_target_as = mem_sleepers_species }
			}
		}
	}
	
	picture_event_data = {
		portrait = event_target:mem_sleepers_country
		room = mem_corridor_room
	}

	option = {
		name = mem_sleepers.200.a
		custom_tooltip = mem_sleepers.200.a.tooltip
		response_text = mem_sleepers.200.a.response
		create_leader = {
			class = scientist
			species = event_target:mem_sleepers_species
			name = random
			skill = 5
			traits = {
				trait = leader_trait_expertise_biology
				trait = mem_leader_trait_last_ozari
			}
		}
	}
	
	option = {
		name = mem_sleepers.200.b
		trigger = {
			NOT = {
				has_ethic = ethic_fanatic_xenophobe
			}
		}
		response_text = mem_sleepers.200.b.response
		add_resource = {
			influence = 75
		}
	}
	
	option = {
		name = mem_sleepers.200.c
		trigger = {
			has_ethic = ethic_fanatic_xenophobe
		}
		response_text = mem_sleepers.200.c.response
		add_resource = {
			influence = 150
		}
	}
}
